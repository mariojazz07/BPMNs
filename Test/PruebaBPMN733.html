<!DOCTYPE html>
<html>

<body>


    <button onclick="myFunction()">Debug</button>

    <p id="demo"></p>
    <p id="demo2"></p>

    <script>
        function myFunction() {
            var result = working();
            document.getElementById("demo").innerHTML = JSON.stringify(result);
            
        }
    </script>
    <script>
        function working() {
//Entradas:
channelId='1';
vSubscriberType='TOD';
subscriberId='94534493';
vStrOfferingInfo='{"bcs:QueryCustomerInfoResultMsg":{"xmlns:bcs":"http://www.huawei.com/bme/cbsinterface/bcservices","xmlns:bcc":"http://www.huawei.com/bme/cbsinterface/bccommon","QueryCustomerInfoResult":{"bcs:Subscriber":{"bcs:PrimaryOffering":{"bcc:BundledFlag":"S","bcc:ProductInst":[{"bcc:PackageFlag":"A","bcc:PrimaryFlag":"M","bcc:NetworkType":1,"bcc:ProductID":1053,"bcc:ProductType":1},{"bcc:PackageFlag":"A","bcc:PrimaryFlag":"A","bcc:NetworkType":1,"bcc:ProductID":1011,"bcc:ProductType":1},{"bcc:PackageFlag":"A","bcc:PrimaryFlag":"A","bcc:NetworkType":1,"bcc:ProductID":1042,"bcc:ProductType":1},{"bcc:PackageFlag":"A","bcc:PrimaryFlag":"A","bcc:NetworkType":1,"bcc:ProductID":1822969218,"bcc:ProductType":1},{"bcc:PackageFlag":"A","bcc:PrimaryFlag":"A","bcc:NetworkType":1,"bcc:ProductID":1014,"bcc:ProductType":1}],"bcc:Status":2,"bcc:OfferingKey":{"bcc:OfferingID":1385568825,"bcc:PurchaseSeq":2086509979},"bcc:OfferingClass":"I"},"bcs:PaymentMode":1,"bcs:SubscriberKey":"subkey94400852","bcs:SubscriberInfo":{"bcs:UserCustomer":{"bcs:CustInfo":{"bcc:CustType":1,"bcc:CustCode":"newcustcode1516294400852","bcc:CustBasicInfo":{"bcc:DFTWrittenLang":2047,"bcc:DFTIVRLang":2047,"bcc:DFTCurrencyID":1153,"bcc:CustLoyalty":"H","bcc:CustLevel":1,"bcc:DunningFlag":3,"bcc:DFTBillCycleType":25,"bcc:CustProperty":[{"bcc:Value":"","bcc:Code":"C_CUST_CATEGORY"},{"bcc:Value":"B127AE7C4004667F","bcc:Code":"C_CUST_SALT"},{"bcc:Value":"","bcc:Code":"C_CUSTOMER_TAX_RATE"},{"bcc:Value":"","bcc:Code":"C_EXTERNAL_CUST_ID"},{"bcc:Value":"N","bcc:Code":"C_CUST_BANKRUPTCY"},{"bcc:Value":"N","bcc:Code":"C_FRAUD_FLAG"},{"bcc:Value":"","bcc:Code":"C_TAX_PAYER_IDENTIFICATION_NO"},{"bcc:Value":"N","bcc:Code":"C_CUST_MEDIA_FLAG"},{"bcc:Value":"N","bcc:Code":"C_CUST_DECEASED"},{"bcc:Value":"","bcc:Code":"C_EVENING_PHONE"},{"bcc:Value":"","bcc:Code":"C_DAYTIME_PHONE"},{"bcc:Value":"N","bcc:Code":"C_CUST_MARKETING_CONSENT"},{"bcc:Value":"","bcc:Code":"C_OLD_IC"},{"bcc:Value":"","bcc:Code":"C_LEGAL_CATEGORY"},{"bcc:Value":0,"bcc:Code":"C_CUST_BILLSUM"},{"bcc:Value":"","bcc:Code":"C_CORP_CUST_SEGMENT"},{"bcc:Value":"","bcc:Code":"C_NEW_IC"},{"bcc:Value":"N","bcc:Code":"C_REG_FLAG"},{"bcc:Value":"","bcc:Code":"C_ACCESSIBILITY_FLAG"},{"bcc:Value":"","bcc:Code":"C_NRC"},{"bcc:Value":101,"bcc:Code":"C_CUST_BelToAreaID"},{"bcc:Value":100000000932331243,"bcc:Code":"C_CUST_ID"}],"bcc:CustSegment":"GOV"},"bcc:CustNodeType":1,"bcc:CustClass":1},"bcs:CustKey":"newcustkey1516294400852","bcs:IndividualInfo":{"bcc:IDNumber":53121,"bcc:IndividualProperty":{"bcc:Value":1,"bcc:Code":"C_MKT_P_STATUS"},"bcc:Gender":1,"bcc:IDValidity":20190919120000,"bcc:LastName":"j","bcc:Title":1,"bcc:IDType":4,"bcc:FirstName":"z"}},"bcc:UserCustomerKey":"newcustkey1516294400852","bcc:Status":2,"bcc:SubClass":2,"bcs:ActivationTime":20190812153024,"bcs:StatusDetail":"000000000000000000000000","bcc:NetworkType":1,"bcc:ActiveTimeLimit":20361212120000,"bcc:SubBasicInfo":{"bcc:IVRLang":2047,"bcc:DunningFlag":1,"bcc:WrittenLang":2047,"bcc:SubProperty":[{"bcc:Value":0,"bcc:Code":"C_FIRST_RECHARGE_FLAG"},{"bcc:Value":"","bcc:Code":"C_SUB_PROB"},{"bcc:Value":"","bcc:Code":"C_WORK_ADDRESS"},{"bcc:Value":0,"bcc:Code":"C_SUB_SMS_ROMING_RIGHT"},{"bcc:Value":"A6E35F7C8F533CD4","bcc:Code":"C_SUB_SALT"},{"bcc:Value":"","bcc:Code":"C_SUB_SERVICEPROVIDER"},{"bcc:Value":0,"bcc:Code":"C_RNW_PRODUCTSET"},{"bcc:Value":"0000","bcc:Code":"C_CALL_COST"},{"bcc:Value":"","bcc:Code":"C_SALES_CHANNEL_ID"},{"bcc:Value":0,"bcc:Code":"C_SUB_DOMESIC_ROAM_CALL_RIGHT"},{"bcc:Value":-1,"bcc:Code":"C_HANDSET_TYPE"},{"bcc:Value":-1,"bcc:Code":"C_SUB_MAX_BALANCE"},{"bcc:Value":"","bcc:Code":"C_SUBSCRIBER_INFO_3"},{"bcc:Value":"","bcc:Code":"C_SUBSCRIBER_INFO_2"},{"bcc:Value":"","bcc:Code":"C_SUBSCRIBER_INFO_4"},{"bcc:Value":19991231180000,"bcc:Code":"C_RESUME_DATE"},{"bcc:Value":-1,"bcc:Code":"C_STARTTIME_OF_SWITCH_COS"},{"bcc:Value":0,"bcc:Code":"C_SUB_PREBARRING"},{"bcc:Value":0,"bcc:Code":"C_SUB_BARRED_DAYS"},{"bcc:Value":0,"bcc:Code":"C_DETAIL"},{"bcc:Value":"","bcc:Code":"C_SUBSCRIBER_INFO_1"},{"bcc:Value":"*","bcc:Code":"C_TIGO_CITY"},{"bcc:Value":0,"bcc:Code":"C_BAK_ORG_CHILD_ACCTID"},{"bcc:Value":"","bcc:Code":"C_HANDSET_NETWORK"},{"bcc:Value":-1,"bcc:Code":"C_SUB_LOW_SPENDING_GATE"},{"bcc:Value":0,"bcc:Code":"C_SUB_LOAN_FLAG"},{"bcc:Value":19700101000000,"bcc:Code":"C_SUB_LASTRGADATE"},{"bcc:Value":0,"bcc:Code":"C_SUB_PORT_IN_FLAG"},{"bcc:Value":"","bcc:Code":"C_TECHNOLOGY"},{"bcc:Value":"","bcc:Code":"C_SUB_NOTIFICATION_TIMES"},{"bcc:Value":0,"bcc:Code":"C_BLACK_FLAG"},{"bcc:Value":"","bcc:Code":"C_SUB_VOICE_ROAM_RIGHT"},{"bcc:Value":"","bcc:Code":"C_HANDSET_BRAND"},{"bcc:Value":0,"bcc:Code":"C_SUB_LASTRECHARGEAMT"},{"bcc:Value":-1,"bcc:Code":"C_HYBRID_PAY_TYPE"},{"bcc:Value":0,"bcc:Code":"C_SUBCOS_FOR_EIPIN"},{"bcc:Value":365,"bcc:Code":"C_SUB_MAX_VALIDITY"},{"bcc:Value":"O","bcc:Code":"C_SUBDISCOUNT"},{"bcc:Value":"00","bcc:Code":"C_SUB_LASTZONETYPE"},{"bcc:Value":0,"bcc:Code":"C_SUB_BLACKLIST_CALL_RIGHT"},{"bcc:Value":0,"bcc:Code":"C_SUB_MSCC_FEE_AMOUNT"},{"bcc:Value":0,"bcc:Code":"C_BACKUP_DAYS"},{"bcc:Value":0,"bcc:Code":"C_IS_PRIMARY_SUBSCRIBER"},{"bcc:Value":1,"bcc:Code":"C_SUB_AUTOTOPUP_LOWBALANCE"},{"bcc:Value":"","bcc:Code":"C_NODO_INFO"},{"bcc:Value":0,"bcc:Code":"C_DAILYRENTNOTIFLAG"},{"bcc:Value":0,"bcc:Code":"C_SUB_REGISTERED_RETAILER"},{"bcc:Value":"","bcc:Code":"C_TIGO_ZONE"},{"bcc:Value":0,"bcc:Code":"C_IS_GROUP_MEMBER"},{"bcc:Value":0,"bcc:Code":"C_DTNotification"},{"bcc:Value":"","bcc:Code":"C_PLACA_INFO"},{"bcc:Value":"","bcc:Code":"C_HANDSET_OS_TYPE"},{"bcc:Value":0,"bcc:Code":"C_SUB_USER_NAME"},{"bcc:Value":0,"bcc:Code":"C_SUB_ZONEINFOS"},{"bcc:Value":3,"bcc:Code":"C_SUB_GPRS_ROAM_RIGHT"},{"bcc:Value":100,"bcc:Code":"C_ETU_STAGE_PERCENT"},{"bcc:Value":0,"bcc:Code":"C_SUB_REGISTERED"},{"bcc:Value":"","bcc:Code":"C_LIFECYCLE"},{"bcc:Value":20000101020000,"bcc:Code":"C_SPEC_NUM_RENT_END_TIME"},{"bcc:Value":0,"bcc:Code":"C_VOD_VIDEO_RIGHT"},{"bcc:Value":-1,"bcc:Code":"C_SUB_LOW_BAL_GATE_1"},{"bcc:Value":"","bcc:Code":"C_LAST_CHARGE_BEGIN_TIME"},{"bcc:Value":-1,"bcc:Code":"C_SUB_LOW_BAL_GATE_2"},{"bcc:Value":-1,"bcc:Code":"C_SUB_LOW_BAL_GATE_3"},{"bcc:Value":19991231180000,"bcc:Code":"C_SUB_LOW_BAL_NOTIFY_DATE"},{"bcc:Value":0,"bcc:Code":"C_SUB_NOROAM_CALL_RIGHT"},{"bcc:Value":-1,"bcc:Code":"C_SUB_LOW_BAL_GATE_4"},{"bcc:Value":-1,"bcc:Code":"C_SUB_LOW_BAL_GATE_5"},{"bcc:Value":1,"bcc:Code":"C_SUB_AUTOTOPUP_RECURRING"},{"bcc:Value":0,"bcc:Code":"C_SUB_LOAN_STATUS"},{"bcc:Value":0,"bcc:Code":"C_GPRS_FORBIDDEN_MAIN_BAL"},{"bcc:Value":0,"bcc:Code":"C_IOD_FLAG"},{"bcc:Value":0,"bcc:Code":"C_ETU_BLACKLIST_DATE"},{"bcc:Value":19700101020000,"bcc:Code":"C_LAST_DATA_SESINI"},{"bcc:Value":0,"bcc:Code":"C_APP_ACTIVE_USAGE"},{"bcc:Value":99999999999,"bcc:Code":"C_SUB_BARRINGCODE"},{"bcc:Value":"","bcc:Code":"C_CONSUMENOTIFYGATE"},{"bcc:Value":"","bcc:Code":"C_SUB_REFEREE_IDENTIFER"},{"bcc:Value":0,"bcc:Code":"C_SUB_INTERROAM_CALL_RIGHT"},{"bcc:Value":0,"bcc:Code":"C_SUB_LOW_BAL_NOTIFY_TIMES"},{"bcc:Value":100000000932331244,"bcc:Code":"C_SUB_ID"}],"bcc:SubLevel":1},"bcc:Brand":1066632215,"bcc:SubIdentity":[{"bcc:PrimaryFlag":1,"bcc:SubIdentityType":1,"bcc:SubIdentity":94400852},{"bcc:PrimaryFlag":2,"bcc:SubIdentityType":2,"bcc:SubIdentity":294400852}]},"bcs:SupplementaryOffering":{"bcc:BundledFlag":"S","bcs:ActivationMode":"A","bcs:ExpirationTime":20270101000000,"bcc:Status":2,"bcs:ActivationTime":20190812153157,"bcc:OfferingKey":{"bcc:OfferingID":1868044185,"bcc:PurchaseSeq":2086509980},"bcs:EffectiveTime":20190812153157,"bcc:OfferingClass":"I"}},"bcs:Customer":{"bcs:CustInfo":{"bcc:CustType":1,"bcc:CustCode":"newcustcode1516294400852","bcc:CustBasicInfo":{"bcc:DFTWrittenLang":2047,"bcc:DFTIVRLang":2047,"bcc:DFTCurrencyID":1153,"bcc:CustLoyalty":"H","bcc:CustLevel":1,"bcc:DunningFlag":3,"bcc:DFTBillCycleType":25,"bcc:CustProperty":[{"bcc:Value":"","bcc:Code":"C_CUST_CATEGORY"},{"bcc:Value":"B127AE7C4004667F","bcc:Code":"C_CUST_SALT"},{"bcc:Value":"","bcc:Code":"C_CUSTOMER_TAX_RATE"},{"bcc:Value":"","bcc:Code":"C_EXTERNAL_CUST_ID"},{"bcc:Value":"N","bcc:Code":"C_CUST_BANKRUPTCY"},{"bcc:Value":"N","bcc:Code":"C_FRAUD_FLAG"},{"bcc:Value":"","bcc:Code":"C_TAX_PAYER_IDENTIFICATION_NO"},{"bcc:Value":"N","bcc:Code":"C_CUST_MEDIA_FLAG"},{"bcc:Value":"N","bcc:Code":"C_CUST_DECEASED"},{"bcc:Value":"","bcc:Code":"C_EVENING_PHONE"},{"bcc:Value":"","bcc:Code":"C_DAYTIME_PHONE"},{"bcc:Value":"N","bcc:Code":"C_CUST_MARKETING_CONSENT"},{"bcc:Value":"","bcc:Code":"C_OLD_IC"},{"bcc:Value":"","bcc:Code":"C_LEGAL_CATEGORY"},{"bcc:Value":0,"bcc:Code":"C_CUST_BILLSUM"},{"bcc:Value":"","bcc:Code":"C_CORP_CUST_SEGMENT"},{"bcc:Value":"","bcc:Code":"C_NEW_IC"},{"bcc:Value":"N","bcc:Code":"C_REG_FLAG"},{"bcc:Value":"","bcc:Code":"C_ACCESSIBILITY_FLAG"},{"bcc:Value":"","bcc:Code":"C_NRC"},{"bcc:Value":101,"bcc:Code":"C_CUST_BelToAreaID"},{"bcc:Value":100000000932331243,"bcc:Code":"C_CUST_ID"}],"bcc:CustSegment":"GOV"},"bcc:CustNodeType":1,"bcc:CustClass":1},"bcs:CustKey":"newcustkey1516294400852","bcs:IndividualInfo":{"bcc:IDNumber":53121,"bcc:IndividualProperty":{"bcc:Value":1,"bcc:Code":"C_MKT_P_STATUS"},"bcc:Gender":1,"bcc:IDValidity":20190919120000,"bcc:LastName":"j","bcc:Title":1,"bcc:IDType":4,"bcc:FirstName":"z"}},"bcs:Account":{"bcs:AcctInfo":{"bcs:BillCycleType":25,"bcs:UserCustomer":{"bcs:CustInfo":{"bcc:CustType":1,"bcc:CustCode":"newcustcode1516294400852","bcc:CustBasicInfo":{"bcc:DFTWrittenLang":2047,"bcc:DFTIVRLang":2047,"bcc:DFTCurrencyID":1153,"bcc:CustLoyalty":"H","bcc:CustLevel":1,"bcc:DunningFlag":3,"bcc:DFTBillCycleType":25,"bcc:CustProperty":[{"bcc:Value":"","bcc:Code":"C_CUST_CATEGORY"},{"bcc:Value":"B127AE7C4004667F","bcc:Code":"C_CUST_SALT"},{"bcc:Value":"","bcc:Code":"C_CUSTOMER_TAX_RATE"},{"bcc:Value":"","bcc:Code":"C_EXTERNAL_CUST_ID"},{"bcc:Value":"N","bcc:Code":"C_CUST_BANKRUPTCY"},{"bcc:Value":"N","bcc:Code":"C_FRAUD_FLAG"},{"bcc:Value":"","bcc:Code":"C_TAX_PAYER_IDENTIFICATION_NO"},{"bcc:Value":"N","bcc:Code":"C_CUST_MEDIA_FLAG"},{"bcc:Value":"N","bcc:Code":"C_CUST_DECEASED"},{"bcc:Value":"","bcc:Code":"C_EVENING_PHONE"},{"bcc:Value":"","bcc:Code":"C_DAYTIME_PHONE"},{"bcc:Value":"N","bcc:Code":"C_CUST_MARKETING_CONSENT"},{"bcc:Value":"","bcc:Code":"C_OLD_IC"},{"bcc:Value":"","bcc:Code":"C_LEGAL_CATEGORY"},{"bcc:Value":0,"bcc:Code":"C_CUST_BILLSUM"},{"bcc:Value":"","bcc:Code":"C_CORP_CUST_SEGMENT"},{"bcc:Value":"","bcc:Code":"C_NEW_IC"},{"bcc:Value":"N","bcc:Code":"C_REG_FLAG"},{"bcc:Value":"","bcc:Code":"C_ACCESSIBILITY_FLAG"},{"bcc:Value":"","bcc:Code":"C_NRC"},{"bcc:Value":101,"bcc:Code":"C_CUST_BelToAreaID"},{"bcc:Value":100000000932331243,"bcc:Code":"C_CUST_ID"}],"bcc:CustSegment":"GOV"},"bcc:CustNodeType":1,"bcc:CustClass":1},"bcs:CustKey":"newcustkey1516294400852","bcs:IndividualInfo":{"bcc:IDNumber":53121,"bcc:IndividualProperty":{"bcc:Value":1,"bcc:Code":"C_MKT_P_STATUS"},"bcc:Gender":1,"bcc:IDValidity":20190919120000,"bcc:LastName":"j","bcc:Title":1,"bcc:IDType":4,"bcc:FirstName":"z"}},"bcs:CurrencyID":1153,"bcs:AcctBasicInfo":{"bcc:ContactInfo":{"bcc:Email":"pcrf@gmail.com","bcc:LastName":"o","bcc:MiddleName":"h","bcc:Title":1,"bcc:FirstName":"z","bcc:MobilePhone":94400852},"bcc:FreeBillMedium":{"bcc:BMCode":1,"bcc:BMType":1},"bcc:AcctProperty":[{"bcc:Value":"","bcc:Code":"C_ACCOUNT_INFO_5"},{"bcc:Value":"","bcc:Code":"C_GRP_IND_ACCT"},{"bcc:Value":"","bcc:Code":"C_INIT_BALANCE"},{"bcc:Value":"","bcc:Code":"C_ACCOUNT_INFO_3"},{"bcc:Value":"","bcc:Code":"C_ACCOUNT_INFO_4"},{"bcc:Value":1,"bcc:Code":"C_POINT_ACCM_FLAG"},{"bcc:Value":"","bcc:Code":"C_RTN"},{"bcc:Value":"","bcc:Code":"C_BILLING_GROUP_NO"},{"bcc:Value":"","bcc:Code":"C_GRACE_PERIOD"},{"bcc:Value":"T","bcc:Code":"C_BILL_TYPE"},{"bcc:Value":1,"bcc:Code":"C_TAX_CORRELATIVE_TYPE"},{"bcc:Value":1,"bcc:Code":"C_ACCOUNT_CATEGORY"},{"bcc:Value":0,"bcc:Code":"C_IS_VPN_ACCT_SUSPEND"},{"bcc:Value":0,"bcc:Code":"C_BUSINESS_TYPE"},{"bcc:Value":"N","bcc:Code":"C_FRAUD_WRITEOFF_FLAG"},{"bcc:Value":"","bcc:Code":"C_IMG_IDX"},{"bcc:Value":"","bcc:Code":"C_ACCOUNT_INFO_1"},{"bcc:Value":"","bcc:Code":"C_ACCOUNT_INFO_2"},{"bcc:Value":"","bcc:Code":"C_PRI_SUB_ID"},{"bcc:Value":"N","bcc:Code":"C_DVD_IDX"},{"bcc:Value":0,"bcc:Code":"C_POINT_EXCHANGE_FLAG"},{"bcc:Value":"","bcc:Code":"C_NIT"},{"bcc:Value":"","bcc:Code":"C_CONTRACT_NUMBER"},{"bcc:Value":"","bcc:Code":"C_PAY_INTIME_DATE"},{"bcc:Value":"","bcc:Code":"C_OVER_DRAFT_FOR_PREPAID"},{"bcc:Value":0,"bcc:Code":"C_ACCOUNT_TAX_EXEMPTION"},{"bcc:Value":"0000","bcc:Code":"C_DUNNING_EXCEPTION_LIST"},{"bcc:Value":"","bcc:Code":"C_MARKETING_CATEGORY"},{"bcc:Value":"","bcc:Code":"C_SOCIETY"},{"bcc:Value":"","bcc:Code":"C_DDI_STATUS"},{"bcc:Value":"N","bcc:Code":"C_BILL_CONFIRM"},{"bcc:Value":"","bcc:Code":"C_ACCOUNT_RELIABILITY"},{"bcc:Value":"","bcc:Code":"C_COLLECTION_CATEGORY"},{"bcc:Value":"","bcc:Code":"C_ACCOUNT_MANDATE_CODE"},{"bcc:Value":"","bcc:Code":"C_RFC"},{"bcc:Value":"N","bcc:Code":"C_CLAIM_FLAG"},{"bcc:Value":"","bcc:Code":"C_ROUTEID"},{"bcc:Value":"","bcc:Code":"C_SUC_AUTOPAY_DATE"},{"bcc:Value":0,"bcc:Code":"C_POINT_DISTRIBUTE_RATE"},{"bcc:Value":"","bcc:Code":"C_DD_REFERENCE"},{"bcc:Value":"","bcc:Code":"C_TERRITORY"},{"bcc:Value":"","bcc:Code":"C_DUE_DATE_TYPE"},{"bcc:Value":"N","bcc:Code":"C_CREDIT_RECALCULATION_FLAG"},{"bcc:Value":"","bcc:Code":"C_BUSINESS_UNIT"},{"bcc:Value":0,"bcc:Code":"C_OTHER_CARRIER"},{"bcc:Value":"","bcc:Code":"C_TAX_POLICY_TYPE"},{"bcc:Value":"","bcc:Code":"C_REF_A"},{"bcc:Value":"N","bcc:Code":"C_LATEFEE_FLAG"},{"bcc:Value":"","bcc:Code":"C_BILL_DISPATCH_CODE"},{"bcc:Value":"","bcc:Code":"C_REF_B"},{"bcc:Value":"","bcc:Code":"C_PRI_SUB_IDENTIFIER"},{"bcc:Value":"","bcc:Code":"C_DCA_NAME"},{"bcc:Value":100000000932331245,"bcc:Code":"C_ACCT_ID"}],"bcc:BillLang":2047,"bcc:RedlistFlag":0,"bcc:AcctName":"PCRF_TEST","bcc:DunningFlag":1,"bcc:LateFeeChargeable":"N"},"bcs:AcctPayMethod":1,"bcs:UserCustomerKey":"newcustkey1516294400852","bcs:AcctCode":"acctpos15162key94400852","bcs:PaymentType":1,"bcs:BillCycleEndDate":20190825000000,"bcs:BillCycleOpenDate":20190725000000,"bcs:AcctType":1,"bcs:AcctClass":1,"bcs:BillCycleInfo":{"bcs:BillCycleType":25,"bcs:ExpireTime":20361231180000,"bcs:EffectiveTime":20190812153024},"bcs:RootAcctKey":"acctpos15162key94400852"},"bcs:AcctKey":"acctpos15162key94400852"}},"xmlns:cbs":"http://www.huawei.com/bme/cbsinterface/cbscommon","ResultHeader":{"cbs:Version":1,"cbs:ResultCode":0,"cbs:ResultDesc":"Operation successfully."}}}';


vFreeUnitWallets='{"bbs:QueryFreeUnitResultMsg":{"QueryFreeUnitResult":{"bbs:FreeUnitItem":[{"bbs:FreeUnitItemDetail":{"bbs:InitialAmount":209715200,"bbs:RollOverFlag":"N","bbs:ExpireTime":20190905000000,"bbs:LastRollOveredTime":19691231180000,"bbs:FreeUnitInstanceID":701000000102289433,"bbs:ReservationAmount":0,"bbs:CurrentAmount":209715200,"bbs:EffectiveTime":20190805000000},"bbs:TotalUnusedAmount":209715200,"bbs:TotalInitialAmount":209715200,"bbs:FreeUnitType":"C_GPRS_RG50","bbs:MeasureUnitName":"KB","bbs:FreeUnitTypeName":"GPRS_RG50","bbs:MeasureUnit":1107},{"bbs:FreeUnitItemDetail":{"bbs:InitialAmount":130,"bbs:RollOverFlag":"N","bbs:ExpireTime":20190905000000,"bbs:LastRollOveredTime":19691231180000,"bbs:FreeUnitInstanceID":701000000105442158,"bbs:ReservationAmount":0,"bbs:FreeUnitOrigin":{"bbs:OriginType":1,"bbs:OfferingKey":{"bbs:PurchaseSeq":"54fa55be-8dd5-4782-a62c-43e1bb55d52e","bbs:OfferingName":"Plan Individual USD 39.99","bbs:OfferingID":706211014}},"bbs:CurrentAmount":130,"bbs:EffectiveTime":20190903120651},"bbs:TotalUnusedAmount":130,"bbs:TotalInitialAmount":130,"bbs:FreeUnitType":"C_SMS_balance_allnet","bbs:MeasureUnitName":"Item","bbs:FreeUnitTypeName":"SMS_balance_allnet","bbs:MeasureUnit":1101},{"bbs:FreeUnitItemDetail":{"bbs:InitialAmount":14680064,"bbs:RollOverFlag":"N","bbs:ExpireTime":20190905000000,"bbs:LastRollOveredTime":19691231180000,"bbs:FreeUnitInstanceID":701000000105442159,"bbs:ReservationAmount":20480,"bbs:FreeUnitOrigin":{"bbs:OriginType":1,"bbs:OfferingKey":{"bbs:PurchaseSeq":"54fa55be-8dd5-4782-a62c-43e1bb55d52e","bbs:OfferingName":"Plan Individual USD 39.99","bbs:OfferingID":706211014}},"bbs:CurrentAmount":14624443,"bbs:EffectiveTime":20190903120651},"bbs:TotalUnusedAmount":14624443,"bbs:TotalInitialAmount":14680064,"bbs:FreeUnitType":"C_Data_Include","bbs:MeasureUnitName":"KB","bbs:FreeUnitTypeName":"Data_Include","bbs:MeasureUnit":1107}]},"xmlns:bbs":"http://www.huawei.com/bme/cbsinterface/bbservices","xmlns:cbs":"http://www.huawei.com/bme/cbsinterface/cbscommon","ResultHeader":{"cbs:Version":1,"cbs:ResultCode":0,"cbs:ResultDesc":"Operation successfully."}}}';

vStrPcc='{"getSubscriberAllInfResponse":{"result":{"resultCode":0,"paras":{"value":"Operation succeeded","key":"errorDescription"},"subscriber":{"attribute":[{"value":50494534493,"key":"USRIDENTIFIER"},{"value":50494534493,"key":"USRMSISDN"},{"value":1,"key":"USRSTATE"},{"value":"","key":"USRHOMESRVZONE"},{"value":1,"key":"USRPAIDTYPE"},{"value":"normal","key":"USRCATEGORY"},{"value":1,"key":"USRSTATION"},{"value":"","key":"USRMASTERIDENTIFIER"},{"value":1,"key":"USRCONTACTMETHOD"},{"value":"","key":"USREMAILADDRESS"},{"value":5,"key":"USRBILLCYCLEDATE"},{"value":"","key":"USRSUBTERMINALTYPE"},{"value":0,"key":"USRCREATETYPE"},{"value":0,"key":"USRMAXOFFLINEDAYS"},{"value":20190903144643,"key":"USRLATESTOFFLINETIME"},{"value":0,"key":"USRSUBNETTYPE"},{"value":69,"key":"USRCUSTOMERATTR"},{"value":"","key":"USREXATTR1"},{"value":"","key":"USREXATTR2"},{"value":"","key":"USREXATTR3"},{"value":"","key":"USREXATTR4"},{"value":"","key":"USREXATTR5"},{"value":"","key":"USREXATTR6"},{"value":"","key":"USREXATTR7"},{"value":"","key":"USREXATTR8"},{"value":"","key":"USREXATTR9"},{"value":"","key":"USREXATTR10"},{"value":"","key":"USRIMSI"},{"value":255,"key":"USRLANGUAGE"},{"value":"","key":"USRSMSMSISDN"},{"value":0,"key":"USRSMSRECEIVEFLAG"},{"value":"","key":"USRSECONDIDENTIFIER"},{"value":"","key":"USRIMEI"},{"value":"","key":"USREXATTRSTR1"},{"value":"","key":"USREXATTRSTR2"},{"value":"","key":"USREXATTRSTR3"},{"value":"","key":"USREXATTR11"},{"value":"","key":"USREXATTRSTR4"},{"value":"","key":"USREXATTRSTR5"},{"value":"","key":"USREXATTRSTR6"},{"value":"","key":"USRBIRTHDAY"},{"value":"","key":"GRPIDENTIFIER"}]},"subscribedService":[{"attribute":[{"value":"Base_Service_OCS_Pos_SY","key":"SRVNAME"},{"value":"","key":"SRVPKGNAME"},{"value":1,"key":"SRVUSAGESTATE"},{"value":20181023191129,"key":"SRVSUBSCRIBEDATE"},{"value":20181105000000,"key":"SRVSTARTDATETIME"},{"value":-1,"key":"SRVOVERDUEDATE"},{"value":-1,"key":"SRVENDDATETIME"},{"value":-1,"key":"SRVROAMINGTYPE"},{"value":0,"key":"SUBSCRIBEDTYPE"},{"value":0,"key":"SRVSTATUS"},{"value":"","key":"SRVWORKDAYSTIMESCHEDULE"},{"value":"","key":"SRVRESTDAYSTIMESCHEDULE"},{"value":"","key":"SRVNEXTACTIVETIME"},{"value":128,"key":"SRVCONTACTMETHOD"},{"value":1,"key":"SRVUSEDFLAG"},{"value":"","key":"SRVEXATTRSTR1"},{"value":"","key":"SRVUSRDEFINEDPERIOD1"},{"value":"","key":"SRVUSRDEFINEDPERIOD2"},{"value":"","key":"SRVUSRDEFINEDPERIOD3"},{"value":"","key":"SRVUSRDEFINEDPERIOD4"},{"value":"","key":"SRVUSRDEFINEDPERIOD5"},{"value":"","key":"SRVUSRDEFINEDPERIOD6"},{"value":"","key":"SRVUSRDEFINEDPERIOD7"},{"value":"","key":"SRVUSRDEFINEDPERIOD8"},{"value":"","key":"SRVUSRDEFINEDPERIOD9"},{"value":"","key":"SRVUSRDEFINEDPERIOD10"},{"value":-1,"key":"SRVACTIVATIONSTARTDATE"},{"value":-1,"key":"SRVACTIVATIONENDDATE"},{"value":0,"key":"SRVRESTTIMEVALUE"},{"value":-1,"key":"REMAINEDVALIDPERIOD"},{"value":0,"key":"ISGROUPSERVICE"},{"value":"Servicio Base Pos Sy T","key":"DESCRIPTION"},{"value":"","key":"SRVCUSTOMERATTR"},{"value":"false","key":"SRVISEXPIRED"}]},{"attribute":[{"value":"OCS_APP_FB_POS_SY","key":"SRVNAME"},{"value":"","key":"SRVPKGNAME"},{"value":1,"key":"SRVUSAGESTATE"},{"value":20181007140604,"key":"SRVSUBSCRIBEDATE"},{"value":20190903121300,"key":"SRVSTARTDATETIME"},{"value":20190903235959,"key":"SRVOVERDUEDATE"},{"value":20190903235959,"key":"SRVENDDATETIME"},{"value":-1,"key":"SRVROAMINGTYPE"},{"value":0,"key":"SUBSCRIBEDTYPE"},{"value":0,"key":"SRVSTATUS"},{"value":"","key":"SRVWORKDAYSTIMESCHEDULE"},{"value":"","key":"SRVRESTDAYSTIMESCHEDULE"},{"value":"","key":"SRVNEXTACTIVETIME"},{"value":128,"key":"SRVCONTACTMETHOD"},{"value":1,"key":"SRVUSEDFLAG"},{"value":"","key":"SRVEXATTRSTR1"},{"value":"","key":"SRVUSRDEFINEDPERIOD1"},{"value":"","key":"SRVUSRDEFINEDPERIOD2"},{"value":"","key":"SRVUSRDEFINEDPERIOD3"},{"value":"","key":"SRVUSRDEFINEDPERIOD4"},{"value":"","key":"SRVUSRDEFINEDPERIOD5"},{"value":"","key":"SRVUSRDEFINEDPERIOD6"},{"value":"","key":"SRVUSRDEFINEDPERIOD7"},{"value":"","key":"SRVUSRDEFINEDPERIOD8"},{"value":"","key":"SRVUSRDEFINEDPERIOD9"},{"value":"","key":"SRVUSRDEFINEDPERIOD10"},{"value":-1,"key":"SRVACTIVATIONSTARTDATE"},{"value":-1,"key":"SRVACTIVATIONENDDATE"},{"value":0,"key":"SRVRESTTIMEVALUE"},{"value":"00000636","key":"REMAINEDVALIDPERIOD"},{"value":0,"key":"ISGROUPSERVICE"},{"value":"Servicio Base Pos Sy T","key":"DESCRIPTION"},{"value":"","key":"SRVCUSTOMERATTR"},{"value":"App Pospago Facebook","key":"SRVPRODUCTNAME"},{"value":"PL","key":"SRVPRODUCTTYPE"},{"value":"3","key":"SRVPRODUCTTYPEID"},{"value":"false","key":"SRVISEXPIRED"}]},{"attribute":[{"value":"OCS_APP_WA_POS_SY","key":"SRVNAME"},{"value":"","key":"SRVPKGNAME"},{"value":1,"key":"SRVUSAGESTATE"},{"value":20181007140447,"key":"SRVSUBSCRIBEDATE"},{"value":20190903121300,"key":"SRVSTARTDATETIME"},{"value":20190903235959,"key":"SRVOVERDUEDATE"},{"value":20190903235959,"key":"SRVENDDATETIME"},{"value":-1,"key":"SRVROAMINGTYPE"},{"value":0,"key":"SUBSCRIBEDTYPE"},{"value":0,"key":"SRVSTATUS"},{"value":"","key":"SRVWORKDAYSTIMESCHEDULE"},{"value":"","key":"SRVRESTDAYSTIMESCHEDULE"},{"value":"","key":"SRVNEXTACTIVETIME"},{"value":128,"key":"SRVCONTACTMETHOD"},{"value":1,"key":"SRVUSEDFLAG"},{"value":"","key":"SRVEXATTRSTR1"},{"value":"","key":"SRVUSRDEFINEDPERIOD1"},{"value":"","key":"SRVUSRDEFINEDPERIOD2"},{"value":"","key":"SRVUSRDEFINEDPERIOD3"},{"value":"","key":"SRVUSRDEFINEDPERIOD4"},{"value":"","key":"SRVUSRDEFINEDPERIOD5"},{"value":"","key":"SRVUSRDEFINEDPERIOD6"},{"value":"","key":"SRVUSRDEFINEDPERIOD7"},{"value":"","key":"SRVUSRDEFINEDPERIOD8"},{"value":"","key":"SRVUSRDEFINEDPERIOD9"},{"value":"","key":"SRVUSRDEFINEDPERIOD10"},{"value":-1,"key":"SRVACTIVATIONSTARTDATE"},{"value":-1,"key":"SRVACTIVATIONENDDATE"},{"value":0,"key":"SRVRESTTIMEVALUE"},{"value":"00000636","key":"REMAINEDVALIDPERIOD"},{"value":0,"key":"ISGROUPSERVICE"},{"value":"Servicio App Pos Sy T","key":"DESCRIPTION"},{"value":"","key":"SRVCUSTOMERATTR"},{"value":"App Pospago Whatsapp","key":"SRVPRODUCTNAME"},{"value":"PL","key":"SRVPRODUCTTYPE"},{"value":"3","key":"SRVPRODUCTTYPEID"},{"value":"false","key":"SRVISEXPIRED"}]}]}}}';



vQueryOffering="'_comment':'**********************************Aplicaciones**********************************',         '1959128569':{'PRODUCT_ID':'353','PRODUCT_NAME':'WhatsApp Ilimitado','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '359129482':{'PRODUCT_ID':'355','PRODUCT_NAME':'Facebook Ilimitado','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1559192057':{'PRODUCT_ID':'358','PRODUCT_NAME':'WhatsApp Ilimitado 10Lps','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '559192373':{'PRODUCT_ID':'403','PRODUCT_NAME':'Pokemon Go','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1559193217':{'PRODUCT_ID':'721','PRODUCT_NAME':'Facebook Ilimitado L.15 1 dia','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1859193596':{'PRODUCT_ID':'722','PRODUCT_NAME':'Instagram Ilimitado L.22 1 dia','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1159727673':{'PRODUCT_ID':'509','PRODUCT_NAME':'Instagram Ilimitado L.20 1 dia','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '759194267':{'PRODUCT_ID':'493','PRODUCT_NAME':'Paquete Facebook Ilimitado(L25/3 dias)','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1759207429':{'PRODUCT_ID':'527','PRODUCT_NAME':'Clash of Clans Ilimitado(L12/1 dia)','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1159207677':{'PRODUCT_ID':'528','PRODUCT_NAME':'Clash Royale Ilimitado(L17/1 dia)','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '959208130':{'PRODUCT_ID':'526','PRODUCT_NAME':'YouTube Ilimitado(L28/1 Hora)','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1868112247':{'PRODUCT_ID':'515','PRODUCT_NAME':'Apps Redes Sociales  Zero Rate (Instagram)','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1968112409':{'PRODUCT_ID':'516','PRODUCT_NAME':'Apps Redes Sociales  Zero Rate (Snapchat)','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1966298539':{'PRODUCT_ID':'532','PRODUCT_NAME':'Whatsapp Ilimitado 7 dias','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '566292865':{'PRODUCT_ID':'535','PRODUCT_NAME':'Whatsapp Chat Ilimitado (L 2 / 2 horas)','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},          '1959128569':{'PRODUCT_ID':'723','PRODUCT_NAME':'Whatsapp Ilimitado Costo Cero','QTA':'0','PROFILE':'0','TYPE':'APP','PACKAGE':'FALSE'},                               '_comment':'**********************************Suscripciones**********************************',         '758697355':{'PRODUCT_ID':'701','PRODUCT_NAME':'WhatsApp Chat Ilim+600MB (L.120/7 dias)','QTA':'614400','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '1558953839':{'PRODUCT_ID':'710','PRODUCT_NAME':'WhatsApp Chat Ilim+1MB (L.10/1 dia)','QTA':'1024','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '158954263':{'PRODUCT_ID':'710','PRODUCT_NAME':'WhatsApp Chat Ilim+1MB (LPSPROMO.30/1 dia)','QTA':'1024','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '358692867':{'PRODUCT_ID':'713','PRODUCT_NAME':'WhatsApp Chat Ilim+50MB (L.20/1 dia)','QTA':'51200','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '558952932':{'PRODUCT_ID':'714','PRODUCT_NAME':'WhatsApp Chat Ilim+100MB (L.30/1 dia)','QTA':'102400','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '1359102943':{'PRODUCT_ID':'479','PRODUCT_NAME':'WhatsApp Chat Ilim+1MB (L.30/1 dia) LPSPROMO','QTA':'1024','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '1959103149':{'PRODUCT_ID':'479','PRODUCT_NAME':'WhatsApp Chat Ilim+1MB (L.5/1 dia)','QTA':'1024','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '1258953445':{'PRODUCT_ID':'714','PRODUCT_NAME':'WhatsApp Chat Ilim+100MB (LPSPROMO.90/1 dia)','QTA':'102400','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '759104425':{'PRODUCT_ID':'716','PRODUCT_NAME':'Suscripcion Fuleados WhatsApp Chat + 600MB 7 dias','QTA':'614400','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '959042546':{'PRODUCT_ID':'477','PRODUCT_NAME':'Whatsapp Chat Ilimitado + 200MB (1 dia)','QTA':'204800','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '1059042221':{'PRODUCT_ID':'477','PRODUCT_NAME':'Whatsapp Chat Ilimitado + 200MB (1 dia)','QTA':'204800','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '778296796':{'PRODUCT_ID':'703','PRODUCT_NAME':'Suscripcion Facebook Ilimitado (L 16 / 1 dia)','QTA':'0','PROFILE':'92','TYPE':'SUS','PACKAGE':'FALSE'},         '968112580':{'PRODUCT_ID':'794','PRODUCT_NAME':'Suscripcion Whatsapp Chat Ilimitado (L 13 / 24 Hrs)','QTA':'0','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},         '1468113001':{'PRODUCT_ID':'993','PRODUCT_NAME':'Suscripcion Whatsapp Chat Ilimitado (L 12 / 24 Hrs)','QTA':'0','PROFILE':'5','TYPE':'SUS','PACKAGE':'FALSE'},          '_comment':'**********************************Combos**********************************',             '1362749781':{'PRODUCT_ID':'265','PRODUCT_NAME':'Paquetigo Duo 5Min y 30MB L15','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1562750247':{'PRODUCT_ID':'266','PRODUCT_NAME':'Paquetigo Chat 25Sms y 30MB L15','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '330041007':{'PRODUCT_ID':'409','PRODUCT_NAME':'Top Up Paquetigo $7','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '930043470':{'PRODUCT_ID':'410','PRODUCT_NAME':'Top Up Paquetigo $10','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '149325165':{'PRODUCT_ID':'474','PRODUCT_NAME':'Paquetigo Mes de la Madre Tigo USA','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '130620711':{'PRODUCT_ID':'711','PRODUCT_NAME':'WP Tigo Shop','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1030620977':{'PRODUCT_ID':'712','PRODUCT_NAME':'WP Tigo Shop','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1333615163':{'PRODUCT_ID':'962','PRODUCT_NAME':'Llamadas Ilimitadas x 7 dias','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1733616044':{'PRODUCT_ID':'963','PRODUCT_NAME':'Llamadas Ilimitadas x 30 dias','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},     '1235209967':{'PRODUCT_ID':'964','PRODUCT_NAME':'Combo 300MB + 25 Minutos + 15SMS','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '935210556':{'PRODUCT_ID':'965','PRODUCT_NAME':'Combo 100MB + 60 Minutos + 30SMS 3 dias Lps.70','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1763253291':{'PRODUCT_ID':'966','PRODUCT_NAME':'Combo 600MB + 50 Minutos + 50SMS 7 dias Lps.160','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'TRUE'},         '1863252750':{'PRODUCT_ID':'967','PRODUCT_NAME':'Combo 30MB + 10 Minutos + 10SMS 1 dia Lps.20','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'TRUE'},         '1867545775':{'PRODUCT_ID':'992','PRODUCT_NAME':'Paq.16 Mins TR/USA/CAN+16MB','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1048351509':{'PRODUCT_ID':'1117','PRODUCT_NAME':'300MB + 25 Minutos + 15SMS+Costo Cero','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '148351673':{'PRODUCT_ID':'1118','PRODUCT_NAME':'100MB+60Min y 30SMS+Costo Cero','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '148351673':{'PRODUCT_ID':'1119','PRODUCT_NAME':'600MB + 50MIN + 50SMS+Costo Cero','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1048351011':{'PRODUCT_ID':'1120','PRODUCT_NAME':'30MB+10Min+10SMS+Costo Cero','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '150163669':{'PRODUCT_ID':'1126','PRODUCT_NAME':'Combo de 5 min Tigo y 30MB','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1950595833':{'PRODUCT_ID':'1127','PRODUCT_NAME':'Combo de 25 msj Tigo y 30MB','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1048351011':{'PRODUCT_ID':'1144','PRODUCT_NAME':'LendME 30MB+10Min+10SMS+Costo Cero','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '955623195':{'PRODUCT_ID':'1154','PRODUCT_NAME':'Paquetigo 70 SMS USA/CAN/TR, L.11, 1 dia','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1855623551':{'PRODUCT_ID':'1155','PRODUCT_NAME':'Paquetigo 150 SMS USA/CAN/TR, L.17, 2 días','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1048351509':{'PRODUCT_ID':'1158','PRODUCT_NAME':'Lend Me 300MB+25min+15sms TR/USA/CAN Cst 0','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1656594820':{'PRODUCT_ID':'1189','PRODUCT_NAME':'Paquetigo 70 Mensajitos, L.11, 1 dia. Vastrix','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '156598631':{'PRODUCT_ID':'1190','PRODUCT_NAME':'Paquetigo 150 Mensajitos, L.17, 2 días. Vastrix','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1665216261':{'PRODUCT_ID':'1259','PRODUCT_NAME':'Combo 15min TR 15MB  2dias L15','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1230045615':{'PRODUCT_ID':'1081','PRODUCT_NAME':'Combo Todo Incluido Mundo #1','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1551863605':{'PRODUCT_ID':'1132','PRODUCT_NAME':'Combo Todo Incluido L.15.00 (L.30 LPS-Promo/100MB/1dias)','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1063251232':{'PRODUCT_ID':'1133','PRODUCT_NAME':'Combo Todo Incluido L.25.00 (L.50 LPS-Promo/250MB/1Amigo/50 Mins On Net/ 1 Dia + Whatsapp Chat Ilimitado','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'TRUE'},         '563265537':{'PRODUCT_ID':'1134','PRODUCT_NAME':'Combo Todo Incluido L.50.00 (L.100 LPS-Promo/500MB/1Amigo/100 Mins On Net/ 3 Dias + Whatsapp Chat Ilimitado','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'TRUE'},         '1063265726':{'PRODUCT_ID':'1135','PRODUCT_NAME':'Combo Todo Incluido L.100.00 (L.200 LPS-Promo/800MB/1Amigo/300 Mins On Net/ 7 Dias + Whatsapp Chat Ilimitado','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'TRUE'},         '1559762405':{'PRODUCT_ID':'1223','PRODUCT_NAME':'Combo Super Recarga L20','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1259762605':{'PRODUCT_ID':'1224','PRODUCT_NAME':'Combo Super Recarga L30','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1259762816':{'PRODUCT_ID':'1225','PRODUCT_NAME':'Combo Super Recarga L40','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1259763098':{'PRODUCT_ID':'1226','PRODUCT_NAME':'Combo Super Recarga L60','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '359763320':{'PRODUCT_ID':'1227','PRODUCT_NAME':'Combo Super Recarga L70','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1059763525':{'PRODUCT_ID':'1228','PRODUCT_NAME':'Combo Super Recarga L80','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1859763701':{'PRODUCT_ID':'1229','PRODUCT_NAME':'Combo Super Recarga L90','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '959763886':{'PRODUCT_ID':'1230','PRODUCT_NAME':'Combo Super Recarga L150','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '559761920':{'PRODUCT_ID':'1247','PRODUCT_NAME':'Combo Super Recarga L5','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1659762245':{'PRODUCT_ID':'1248','PRODUCT_NAME':'Combo Super Recarga L10','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'FALSE'},         '1162748441':{'PRODUCT_ID':'226','PRODUCT_NAME':'100MB/24hrs (L.40)FB/Whatsapp','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'TRUE'},         '1164737562':{'PRODUCT_ID':'529','PRODUCT_NAME':'Paquete 4G LTE','QTA':'0','PROFILE':'0','TYPE':'CMB','PACKAGE':'TRUE'}";


vOfferingPlanVAS='1885890045';
vPurchaseSeqVAS='NA';

//vAddonRetExpire='';
//vAddonRetOffering='';

bundlePlanChildOffers='';

//InitValues
var STR_PAD_LEFT = 1;
var STR_PAD_RIGHT = 2;
var STR_PAD_BOTH = 3;
var BPMN_RESPONSE_CODE = '100';
var BPMN_RESPONSE_MESSAGE = 'Error durante el proceso.';
var vSysDate = new Date();
var strPackBalance = 'C_Internet_Pack';
var strPlanBalance = 'C_Data_Include';
var strSusBalance = 'C_Internet_Suscripcion';
var strAddonBalance = 'C_Data_Add';
var forCounter = 0;
var forPlanCounter=0;
var doLoop = false;
var doPlanLoop=false;
var vAddonProfile = '110';
var plMultiQuota = false;
var multiQuotasLst = 'NXS';
var quotaBL = 'TEST_FUP_APP_FACEBOOK Quota';
var vSkipBundle = false;
var vSkipChannels = '30';
var vUnifyAppsChannels = '30';
var vUnifyApps = false;
var vChannelPC = '30';

if(typeof(CHANNELS) != 'undefined'){
    vSkipChannels = CHANNELS;
}
if(typeof(CHANNEL_PC) != 'undefined'){
    vChannelPC = CHANNEL_PC;
}
if(typeof(CHANNELS_APP) != 'undefined'){
    vUnifyAppsChannels = CHANNELS_APP;
}
if(typeof(QUOTA_BL) != 'undefined'){
    quotaBL = QUOTA_BL;
}
if(typeof(MULTI_LST) != 'undefined'){
    multiQuotasLst = MULTI_LST;
}
if(typeof(ORIGEN) != 'undefined'){
    plMultiQuota = multiQuotasLst.toUpperCase().indexOf(ORIGEN.toUpperCase()) >= 0;
}
vSkipBundle = checkChannels(vSkipChannels);
vUnifyApps = checkChannels(vUnifyAppsChannels);

function checkChannels(channelLst){
    var chnnlArray = channelLst.split(',');
    var flag = false;
    for(var i = 0; i < chnnlArray.length; i++){
        if(chnnlArray[i] == channelId){
            flag = true;
            break;
        }
    }
    return flag;
}

//Funcion a la cual se le manda un valor y le hace lpad o rpad con el caracter indicado y la longitud indicada
function padStr(str, len, pad, dir) {
    if (typeof(len) == 'undefined') { var len = 0; };
    if (typeof(pad) == 'undefined') { var pad = ' '; };
    if (typeof(dir) == 'undefined') { var dir = STR_PAD_RIGHT; };
    if (len + 1 >= str.length) {
        switch (dir){
            case STR_PAD_LEFT:
                str = Array(len + 1 - str.length).join(pad) + str;
            break;
            case STR_PAD_BOTH:
                var right = Math.ceil((padlen = len - str.length) / 2);
                var left = padlen - right;
                str = Array(left+1).join(pad) + str + Array(right+1).join(pad);
            break;
            default:
                str = str + Array(len + 1 - str.length).join(pad);
            break;
        } // switch
    }
    return str;
}
//Convierte un valor texto a al formato yyyyMMddhhmiss
function parseDateToStringCBS(date){
    var day = padStr(String(date.getDate()), 2, '0', STR_PAD_LEFT);
    var year = date.getFullYear();
    var month = date.getMonth() + 1;
    month = padStr(String(month), 2, '0', STR_PAD_LEFT);
    var hours = padStr(String(date.getHours()), 2, '0', STR_PAD_LEFT);
    var minutes = padStr(String(date.getMinutes()), 2, '0', STR_PAD_LEFT);
    var seconds = padStr(String(date.getSeconds()), 2, '0', STR_PAD_LEFT);
    var format = year + '' + month + '' + day + '' + hours + '' + minutes + '' + seconds;
    return format;
}
//Convierte un Time a un string de Date en formato yyyy-MM-ddThh:mm:ss.000-06:00
function parseTimeToDate(date, timeZone) {
    var strDate = parseDateToString(date);
    strDate = timeZone ? strDate.replace(' ','T') + '.000-06:00' : strDate.replace(' ','T');    
    return strDate;
}
//Transforma un string con formato de fecha a un objeto Date
function parseStringToDate (strDate) {
    strDate = strDate.replace(/\D/g,' ');
    var dateArray = strDate.split(' ');
    var year = dateArray[0];
    var month = dateArray[1] - 1;
    var day = dateArray[2];
    var hours = dateArray[3];
    var minutes = dateArray[4];
    var seconds = dateArray[5];
    return new Date(year,month,day,hours,minutes,seconds);
}

//Convierte '22/02/2018 23:59:59' 

function parseStringToDate_2 (strDate) {
    strDate = strDate.replace(/\D/g,' ');
    var dateArray = strDate.split(' ');
     var day = dateArray[0];
  var month = dateArray[1]-1;
  var year = dateArray[2];  
    
    var hours = dateArray[3];
    var minutes = dateArray[4];
    var seconds = dateArray[5];
    return new Date(year,month,day,hours,minutes,seconds);
}

//Convierte un valor texto a al formato yyyy-MM-dd hh:mm:ss
function parseDateToString(date){
    var day = padStr(String(date.getDate()), 2, '0', STR_PAD_LEFT);
    var year = date.getFullYear();
    var month = date.getMonth() + 1;
    month = padStr(String(month), 2, '0', STR_PAD_LEFT);
    var hours = padStr(String(date.getHours()), 2, '0', STR_PAD_LEFT);
    var minutes = padStr(String(date.getMinutes()), 2, '0', STR_PAD_LEFT);
    var seconds = padStr(String(date.getSeconds()), 2, '0', STR_PAD_LEFT);
    var format = year + '-' + month + '-' + day + ' ' + hours + ':' + minutes + ':' + seconds;
    return format;
}
function getCbsDate(cbsDate){
    var vYear = cbsDate.substring(0, 4);
    var vMonth = new Number(cbsDate.substring(4, 6)) - 1;
    var vDay = cbsDate.substring(6, 8);
    var vHours = cbsDate.substring(8, 10);
    var vMinutes = cbsDate.substring(10, 12);
    var vSeconds = cbsDate.substring(12, 14);
    return new Date(vYear,vMonth,vDay,vHours,vMinutes,vSeconds);
}


var tSaltoL = '\n';

var tLinea = tSaltoL + '************************************************************************' + tSaltoL ;
//

//CBSFunctions
    function getJSON(strJson){
    var vExpr = '([b,c,s]+|[t*,n,s,(0-9)*]+|[v,(0-9)*]+):';
    var vNumExpr = '("[a-z]+":)([0-9]+)(\s*,|}|$)';
    var regEx;
    var numRegExp;
    var tmpJson = '';
    if(typeof REG_EXP != 'undefined'){
        vExpr = REG_EXP;
    }
    regEx = new RegExp(vExpr, 'gi');
    numRegExp = new RegExp(vNumExpr, 'gmi');
    tmpJson = strJson.replace(regEx, '');
    tmpJson = tmpJson.replace(numRegExp, '$1"$2"$3');
    return JSON.parse(tmpJson);
}

function getBillCycleCBS(jsonObj){
    var vBillingCycle='-';
    var vSubscriberAccount;
    if(typeof jsonObj.QueryCustomerInfoResultMsg!='undefined'){
        vSubscriberAccount=jsonObj.QueryCustomerInfoResultMsg.QueryCustomerInfoResult.Account;
        
        if(vSubscriberAccount instanceof Array){
                vBillingCycle=vSubscriberAccount[0].AcctInfo.BillCycleType;
                //console.log(tLinea+'Array'+tLinea);
        }
        else{
            vBillingCycle=vSubscriberAccount.AcctInfo.BillCycleType;
        }
    }

    //console.log(tLinea+'vBillingCycle:'+vBillingCycle+tLinea);
    
    return vBillingCycle;

}

function getPrimaryOfferings(validOfferings, jsonObj){
    var offeringObj;
    var primaryOffering;
    var vItem;
    var vOfferingItem;
    var vOfferings = new Array();
    if(typeof(jsonObj.QueryCustomerInfoResultMsg) != 'undefined'){
        primaryOffering = jsonObj.QueryCustomerInfoResultMsg.QueryCustomerInfoResult.Subscriber.PrimaryOffering;
    }
    if(typeof(primaryOffering) != 'undefined'){
        if(primaryOffering instanceof Array){
            for(var i = 0; i < primaryOffering.length; i++){
                vItem = primaryOffering[i];
                vOfferingItem = vItem.OfferingKey;
                if(typeof(vOfferingItem) != 'undefined'){
                    if(isValidOffering(validOfferings, vOfferingItem.OfferingID) || validOfferings == ''){
                        vOfferings.push(vItem);
                    }
                }
            }
        } else {
            vOfferingItem = primaryOffering.OfferingKey;
            if(typeof(vOfferingItem) != 'undefined'){
                if(isValidOffering(validOfferings, vOfferingItem.OfferingID) || validOfferings == ''){
                    vOfferings.push(primaryOffering);
                }
            }
        }
    }
    return vOfferings;



}

function getSupplementaryOfferings(validOfferings, jsonObj){
    var offeringObj;
    var supplementaryOfferings;
    var vItem;
    var vOfferingItem;
    var vOfferings = new Array();
    if(typeof(jsonObj.QueryCustomerInfoResultMsg) != 'undefined'){
        supplementaryOfferings = jsonObj.QueryCustomerInfoResultMsg.QueryCustomerInfoResult.Subscriber.SupplementaryOffering;
    }
    if(typeof(supplementaryOfferings) != 'undefined'){
        if(supplementaryOfferings instanceof Array){
            for(var i = 0; i < supplementaryOfferings.length; i++){
                vItem = supplementaryOfferings[i];
                vOfferingItem = vItem.OfferingKey;
                if(typeof(vOfferingItem) != 'undefined'){
                    if(isValidOffering(validOfferings, vOfferingItem.OfferingID) || validOfferings == ''){
                        vOfferings.push(vItem);
                    }
                }
            }
        } else {
            vOfferingItem = supplementaryOfferings.OfferingKey;
            if(typeof(vOfferingItem) != 'undefined'){
                if(isValidOffering(validOfferings, vOfferingItem.OfferingID) || validOfferings == ''){
                    vOfferings.push(supplementaryOfferings);
                }
            }
        }
    }
    return vOfferings;
}


function getWalletByType(strWalletName, walletJson){
    var walletObj;
    var freeUnits;
    var vItem;
    if(typeof(walletJson.QueryFreeUnitResultMsg) != 'undefined'){
        freeUnits = walletJson.QueryFreeUnitResultMsg.QueryFreeUnitResult.FreeUnitItem;
    }
    if(typeof(freeUnits) != 'undefined'){
        if(freeUnits instanceof Array){
            for(var i = 0; i < freeUnits.length; i++){
                vItem = freeUnits[i];
                if(vItem.FreeUnitType == strWalletName){
                    walletObj = vItem;
                    break;
                }
            }
        } else {
            if(freeUnits.FreeUnitType == strWalletName){
                walletObj = freeUnits;
            }
        }
    }
    return walletObj;
}
function isValidOffering(validOfferings, offering){
    var flag = false;
    var tmpArray = validOfferings.split(',');
    for(var i = 0; i < tmpArray.length; i++){
        if(tmpArray[i] == offering){
            flag = true;
            break;
        }
    }
    return flag;
}
function trimExhaustedInstances(instances){
    var tmpInstances = new Array();
    var flag = false;
    if(instances instanceof Array){
        for(var i = 0; i < instances.length; i++){
            if(typeof(instances[i].CurrentAmount) != 'undefined'){
                flag = true;
                if(new Number(instances[i].CurrentAmount) > 0){
                    tmpInstances.push(instances[i]);
                }
            }
        }
    } else {
        if(typeof(instances.CurrentAmount) != 'undefined'){
            flag = true;
            if(new Number(instances.CurrentAmount) > 0){
                tmpInstances.push(instances);
            }
        }
    }
    tmpInstances = flag ? tmpInstances : instances;
    return tmpInstances;
}


function trimExhaustedInstancesPospaid(instances){
    var tmpInstances = new Array();
    var flag = false;
    if(instances instanceof Array){
        for(var i = 0; i < instances.length; i++){
            if(typeof(instances[i].CurrentAmount) != 'undefined'){
                flag = true;
                if(new Number(instances[i].CurrentAmount) >= 0){///Se cambio a >= 0 la instancia de pospago
                    tmpInstances.push(instances[i]);
                }
            }
        }
    } else {
        if(typeof(instances.CurrentAmount) != 'undefined'){
            flag = true;
            if(new Number(instances.CurrentAmount) >= 0){///Se cambio a >= 0 la instancia de pospago
                tmpInstances.push(instances);
            }
        }
    }
    tmpInstances = flag ? tmpInstances : instances;
    return tmpInstances;
}


function getSortedItems(itemArray){
    var sortedInstances = new Array();
    var tmpInstances = trimExhaustedInstances(itemArray);
    if(tmpInstances instanceof Array){
        if(tmpInstances.length > 0){
            sortedInstances = quickSort(tmpInstances, 0, (tmpInstances.length - 1));
        }
    } else{
        sortedInstances.push(tmpInstances);
    }
    return sortedInstances;
}

function getSortedItemsPospaid(itemArray){
    var sortedInstances = new Array();
    var tmpInstances = trimExhaustedInstancesPospaid(itemArray);
    if(tmpInstances instanceof Array){
        if(tmpInstances.length > 0){
            sortedInstances = quickSort(tmpInstances, 0, (tmpInstances.length - 1));
        }
    } else{
        sortedInstances.push(tmpInstances);
    }
    return sortedInstances;
}


function swap(items, firstIdx, secondIdx){
    var tmp = items[firstIdx];
    items[firstIdx] = items[secondIdx];
    items[secondIdx] = tmp;
    return items;
}


function partition(items, pivot, left, right){
    var partitionIdx = left;
    var pivotValue = new Number(pivot.EffectiveTime);
    var itemI = 0;
    for(var i = left; i < right; i++){
        itemI = new Number(items[i].EffectiveTime);
        if(itemI < pivotValue){
            swap(items, i, partitionIdx);
            partitionIdx++;
        }
    }
    swap(items, right, partitionIdx);
    return partitionIdx;
}


function quickSort(items, left, right){
    var len = items.length;
    var pivot;
    var partitionIdx;
    if(len > 1){
        if(left < right){
            pivot = items[right];
            partitionIdx = partition(items, pivot, left, right);
            //sort left and right
           quickSort(items, left, partitionIdx - 1);
           quickSort(items, partitionIdx + 1, right);
        }
    }
    return items;
}
//


//PccFunction
    function processJson(strJsonInfo){
    var vSubscribedServices;
    var vSubscriberQuotas;
    var vSubscriber;
    var vJsonObj;
    var vDataObj = new Object();
    var vTmpObj = new Object();
    if(typeof strJsonInfo != 'undefined'){
        vJsonObj = JSON.parse(strJsonInfo);
        if(vJsonObj.getSubscriberAllInfResponse.result.resultCode == 0){
            vSubscriber = vJsonObj.getSubscriberAllInfResponse.result.subscriber;
            if(typeof vJsonObj.getSubscriberAllInfResponse.result.subscribedService != 'undefined'){
                vSubscribedServices = vJsonObj.getSubscriberAllInfResponse.result.subscribedService;
                vSubscriberQuotas = vJsonObj.getSubscriberAllInfResponse.result.subscriberQuota;
                if(vSubscribedServices instanceof Array){
                  for(var i = 0; i < vSubscribedServices.length; i++){
                    vDataObj = setDataProperties(joinInfo(vSubscribedServices[i], vSubscriberQuotas), vDataObj);
                  }
                } else {
                  vDataObj = setDataProperties(joinInfo(vSubscribedServices, vSubscriberQuotas), vDataObj);
                }
            }
            vDataObj.User = joinInfo(undefined, undefined, vSubscriber);
        }
    }
    return vDataObj;
}

function getAttribute(serviceItems, attribute){
    var attributeItem = {key: 'NA', value: 'NA'};
    if(typeof serviceItems != 'undefined'){
        for(var i = 0; i < serviceItems.attribute.length; i++){
            if(serviceItems.attribute[i].key == attribute){
                attributeItem = serviceItems.attribute[i];
                break;
            }
        }
    }
    return attributeItem;
}
function getQuota(quotaItems, serviceName){
    var quotaItem = new Array();
    if(typeof(quotaItems) != 'undefined'){
        if(quotaItems instanceof Array){
            for(var i = 0; i < quotaItems.length; i++){
                if(getAttribute(quotaItems[i], 'SRVNAME').value == serviceName){
                    quotaItem.push(quotaItems[i]);
                }
            }
        } else {
            if(getAttribute(quotaItems, 'SRVNAME').value == serviceName){
                quotaItem.push(quotaItems);
            }
        }
    }
    return quotaItem;
}
function getUniqueQuota(quotaItems){
    var quotaItem;
    if(typeof(quotaItems) != 'undefined'){
        if(quotaItems instanceof Array){
            for(var i = 0; i < quotaItems.length; i++){
                if(quotaBL.toUpperCase().indexOf(getAttribute(quotaItems[i], 'QTANAME').value.toUpperCase()) < 0){
                    quotaItem = quotaItems[i];
                    break;
                }
            }
        } else {
            if(quotaBL.toUpperCase().indexOf(getAttribute(quotaItems, 'QTANAME').value.toUpperCase()) < 0){
                quotaItem = quotaItems;
            }
        }
    }
    return quotaItem;
}
function joinInfo(serviceItem, quotaItem, subscriberItem){
    var tmpObj = new Object();
    var itemTmp;
    var quotaArray = new Array();
    var tmpQuotaArray = new Array();
    var quotaObj;
    var tmpQuota = new Object();
    tmpObj.ServiceName = getAttribute(serviceItem, 'SRVNAME').value;
    tmpObj.ProductName = getAttribute(serviceItem, 'SRVPRODUCTNAME').value;
    quotaArray = getQuota(quotaItem, tmpObj.ServiceName);
    itemTmp = getAttribute(serviceItem, 'SRVPRODUCTTYPE');
    tmpObj.ServiceType = tmpObj.ServiceName == 'Default_Service_Local' ? 'DEF' : itemTmp.value;
    itemTmp = getAttribute(serviceItem, 'SRVPRODUCTTYPEID');
    tmpObj.ServiceTypeId = itemTmp.value;
    tmpObj.ServiceExpired = getAttribute(serviceItem, 'SRVISEXPIRED').value;
    tmpObj.ServiceStartDate = getAttribute(serviceItem, 'SRVSTARTDATETIME').value;
    tmpObj.ServiceEndDate = getAttribute(serviceItem, 'SRVENDDATETIME').value;
    if(!plMultiQuota){
        if(quotaArray.length > 0){
            quotaObj = getUniqueQuota(quotaArray);
        }
        tmpObj.QuotaName = getAttribute(quotaObj, 'QTANAME').value;
        tmpObj.QuotaValue = getAttribute(quotaObj, 'QTAVALUE').value;
        tmpObj.QuotaBalance = getAttribute(quotaObj, 'QTABALANCE').value;
        tmpObj.QuotaConsumption = getAttribute(quotaObj, 'QTACONSUMPTION').value;
        tmpObj.QuotaValueMb = getAttribute(quotaObj, 'QTAVALUE_MB').value;
        tmpObj.QuotaBalanceMb = getAttribute(quotaObj, 'QTABALANCE_MB').value;
        tmpObj.QuotaConsumptionMb = getAttribute(quotaObj, 'QTACONSUMPTION_MB').value;
        tmpObj.QuotaPercentage = getAttribute(quotaObj, 'QTAPERCENTAGE').value;
        tmpObj.QuotaStatus = getAttribute(quotaObj, 'QTASTATUS').value;
        tmpObj.SubscriberBillCycle = getAttribute(subscriberItem, 'USRBILLCYCLEDATE').value;
    } else {
        if(tmpObj.ServiceType == 'PL'){
            for(var i = 0; i < quotaArray.length; i++){
                tmpQuota.QuotaName = getAttribute(quotaArray[i], 'QTANAME').value;
                tmpQuota.QuotaValue = getAttribute(quotaArray[i], 'QTAVALUE').value;
                tmpQuota.QuotaBalance = getAttribute(quotaArray[i], 'QTABALANCE').value;
                tmpQuota.QuotaConsumption = getAttribute(quotaArray[i], 'QTACONSUMPTION').value;
                tmpQuota.QuotaValueMb = getAttribute(quotaArray[i], 'QTAVALUE_MB').value;
                tmpQuota.QuotaBalanceMb = getAttribute(quotaArray[i], 'QTABALANCE_MB').value;
                tmpQuota.QuotaConsumptionMb = getAttribute(quotaArray[i], 'QTACONSUMPTION_MB').value;
                tmpQuota.QuotaPercentage = getAttribute(quotaArray[i], 'QTAPERCENTAGE').value;
                tmpQuota.QuotaStatus = getAttribute(quotaArray[i], 'QTASTATUS').value;
                tmpQuotaArray.push(tmpQuota);
                tmpQuota = new Object();
            }
            tmpObj.Quotas = tmpQuotaArray;
        } else {
            if(quotaArray.length > 0){
                quotaObj = getUniqueQuota(quotaArray);
            }
            tmpObj.QuotaName = getAttribute(quotaObj, 'QTANAME').value;
            tmpObj.QuotaValue = getAttribute(quotaObj, 'QTAVALUE').value;
            tmpObj.QuotaBalance = getAttribute(quotaObj, 'QTABALANCE').value;
            tmpObj.QuotaConsumption = getAttribute(quotaObj, 'QTACONSUMPTION').value;
            tmpObj.QuotaValueMb = getAttribute(quotaObj, 'QTAVALUE_MB').value;
            tmpObj.QuotaBalanceMb = getAttribute(quotaObj, 'QTABALANCE_MB').value;
            tmpObj.QuotaConsumptionMb = getAttribute(quotaObj, 'QTACONSUMPTION_MB').value;
            tmpObj.QuotaPercentage = getAttribute(quotaObj, 'QTAPERCENTAGE').value;
            tmpObj.QuotaStatus = getAttribute(quotaObj, 'QTASTATUS').value;
            tmpObj.SubscriberBillCycle = getAttribute(subscriberItem, 'USRBILLCYCLEDATE').value;
        }
    }
    return tmpObj;
}
function setDataProperties(objItem, dataItem){
    switch(objItem.ServiceType){
        case 'PAQ':
            dataItem.Packages = objItem;
            break;
        case 'SUS':
            dataItem.Subscriptions = objItem;
            break;
        case 'PL':
            dataItem.Plans = objItem;
            break;
        case 'APP':
            if(typeof dataItem.Applications == 'undefined'){
                dataItem.Applications = new Array();
            }
            dataItem.Applications.push(objItem);
            break;
        case 'ADD':
            if(typeof dataItem.Addons == 'undefined'){
                dataItem.Addons = new Array();
            }
            dataItem.Addons.push(objItem);
            break;
        case 'DEF':
            dataItem.DefaultService = objItem;
            break;
        case 'SUB':
            dataItem.User = objItem;
            break;
        default:
            if(typeof dataItem.Unbound == 'undefined'){
                dataItem.Unbound = new Array();
            }
            dataItem.Unbound.push(objItem);
    }
    return dataItem;
}
//


//SetObjects
    var navObject = setNavObjects();
var enrichedOfferings = {
    appOfferings: [],
    susOfferings: [],
    cmbOfferings: [],
    packOfferings: [],
    undefOfferings: [],
    planOfferings: []
    //,addonsOfferings: [],addonsT2Offerings: []
};
var bPckOffers = new Array();
var supplementaryOffers = new Array();
var primaryOffers = new Array();
var subscriptionItems = new Array();
var packageWallet;
var planWallet;
var addonWallet;
var tmpOffers;
var tmpOffers_plan;
var tmpOffers_addons;
var activePackSeq = '0';
var activePlanSeq = '0';
var activeAddSeq = '0';
var activeAppsSeq = new Array();
var packInstances;
var planInstances;
var addInstances;
var tmpInstances;
var tmpInstances_plan;
var tmpInstances_add;
var tmpInstances_addT2;
var planBillCycle = '-';
var vACLExist=false;

if(typeof vExists!= 'undefined'){
    if(vExists=='true'){
        vACLExist=true;
    }
}

if (navObject.offeringJson.filled) {
    supplementaryOffers = getSupplementaryOfferings("", navObject.offeringJson.obj);
    primaryOffers = getPrimaryOfferings("", navObject.offeringJson.obj);
    planBillCycle = getBillCycleCBS(navObject.offeringJson.obj);
    console.log(tLinea+'planBillCycle:'+ planBillCycle+tLinea);
}

if (navObject.walletJson.filled) {
    packageWallet = getWalletObj(strPackBalance, navObject.walletJson);
    planWallet = getWalletObj(strPlanBalance, navObject.walletJson);
    addonWallet = getWalletObj(strAddonBalance, navObject.walletJson);
}

if (typeof (packageWallet) != 'undefined') {
    tmpOffers = getSortedItems(packageWallet.FreeUnitItemDetail);
    activePackSeq = tmpOffers.length > 0 ? tmpOffers[0].FreeUnitOrigin.OfferingKey.PurchaseSeq : '0';
}

if (typeof (planWallet) != 'undefined') {
    //tmpOffers_plan = getSortedItems(planWallet.FreeUnitItemDetail);
    tmpOffers_plan = getSortedItemsPospaid(planWallet.FreeUnitItemDetail);
    activePlanSeq = tmpOffers_plan.length > 0 ? tmpOffers_plan[0].FreeUnitOrigin.OfferingKey.PurchaseSeq : '0';
}

if (typeof (addonWallet) != 'undefined') {
    tmpOffers_addons = getSortedItems(addonWallet.FreeUnitItemDetail);
    activeAddSeq = tmpOffers_addons.length > 0 ? tmpOffers_addons[0].FreeUnitOrigin.OfferingKey.PurchaseSeq : '0';
}

function setNavObjects() {
    var navObject = {walletJson: {filled: false},offeringJson: {filled: false},pccJson: {filled: false}};

    if (typeof (vFreeUnitWallets) != 'undefined') {
        navObject.walletJson.obj = getJSON(vFreeUnitWallets);
        navObject.walletJson.filled = true;
    }

    if (typeof (vStrOfferingInfo) != 'undefined') {
        navObject.offeringJson.obj = getJSON(vStrOfferingInfo);
        navObject.offeringJson.filled = true;
    }

    if (typeof (vStrPcc) != 'undefined') {
        navObject.pccJson.obj = processJson(vStrPcc);
        navObject.pccJson.filled = true;
    }

    return navObject;
}

function getWalletObj(walletName, walletObj) {
    var tmpItm;
    if (walletObj.filled) {
        tmpItm = getWalletByType(walletName, walletObj.obj);
    }
    return tmpItm;
}

function setEnrichment(pEnriched, enrichedItem) {
    var enrichedObj = pEnriched;
    switch (enrichedItem.offerType) {
        case 'APP':
            enrichedObj.appOfferings.push(enrichedItem);
            break;
        case 'SUS':
        case 'SUSAPP':
            enrichedObj.susOfferings.push(enrichedItem);
            break;
        case 'PAQ':
            enrichedObj.packOfferings.push(enrichedItem);
            break;
        case 'CMB':
            enrichedObj.cmbOfferings.push(enrichedItem);
            break;
        case 'PLAN':
            enrichedObj.planOfferings.push(enrichedItem);
            break;
            // case 'ADD':
            //     enrichedObj.addonsOfferings.push(enrichedItem);
            //     break;
            // case 'ADDRET':
            //     enrichedObj.addonsT2Offerings.push(enrichedItem);
            //     break;
        default:
            enrichedObj.undefOfferings.push(enrichedItem);
            break;
    }
    return enrichedObj;
}

function splitInstancesPlan(itemArray, activeId) {
    var activeInstance = new Object();
    var queuedInstances = new Array();
    var splitObj = new Array();
    var strtIdx = 0;
    if (itemArray instanceof Array) {
        if (itemArray.length > 0) {
            for (var i = 0; i < itemArray.length; i++) {
                 
                if (activeId == itemArray[i].FreeUnitOrigin.OfferingKey.PurchaseSeq) {
                    activeInstance = itemArray[i];
                    //strtIdx = 1;
                }
                // if (itemArray.length >= 1) {
                //     for (var i = strtIdx; i < itemArray.length; i++) {
                //         queuedInstances.push(itemArray[i]);
                //     }
                // }
            }
        }
    } else {
        if (activeId == itemArray.FreeUnitOrigin.OfferingKey.PurchaseSeq) {
            activeInstance = itemArray;
        } else {
            queuedInstances.push(itemArray);
        }
    }
    splitObj.active = activeInstance;
    //splitObj.queued = queuedInstances;
    return splitObj;
}

function splitInstancesAddons(itemArray, activeOff) {
    var addRetInstance = new Object();
    var addInstance = new Array();
    var splitObj = new Array();
    if (itemArray instanceof Array) {
        if (itemArray.length > 0) {
            for (var i = 0; i < itemArray.length; i++) {
            //      if(java.lang.Thread.interrupted()){
			// 	break;
			// }
                if (activeOff == itemArray[i].FreeUnitOrigin.OfferingKey.OfferingID) {
                    addRetInstance = itemArray[i];
                } else {
                    addInstance.push(itemArray[i]);
                }
            }
        }
    } else {
        if (activeOff == itemArray.FreeUnitOrigin.OfferingKey.OfferingID) {
            addRetInstance = itemArray;
        } else {
            addInstance.push(itemArray);
        }
    }
    splitObj.addonsT2 = addRetInstance;
    splitObj.addons = addInstance;
    return splitObj;
}

function splitInstances(itemArray, activeId) {
    var activeInstance = new Object();
    var queuedInstances = new Array();
    var splitObj = new Array();
    var strtIdx = 0;
    if (itemArray instanceof Array) {
        if (itemArray.length > 0) {
            if (activeId == itemArray[0].FreeUnitOrigin.OfferingKey.PurchaseSeq) {
                activeInstance = itemArray[0];
                strtIdx = 1;
            }
            if (itemArray.length >= 1) {
                for (var i = strtIdx; i < itemArray.length; i++) {
            //         if(java.lang.Thread.interrupted()){
			// 	break;
			// }
                    queuedInstances.push(itemArray[i]);
                }
            }
        }
    } else {
        if (activeId == itemArray.FreeUnitOrigin.OfferingKey.PurchaseSeq) {
            activeInstance = itemArray;
        } else {
            queuedInstances.push(itemArray);
        }
    }
    splitObj.active = activeInstance;
    splitObj.queued = queuedInstances;
    return splitObj;
}

function snatchInstances(itemArray, offeringLst, include, snatchIns, snatchSeq) {
    var snatchedInstances = new Array();
    var snatchId = '';
    if (itemArray instanceof Array) {
        for (var i = 0; i < itemArray.length; i++) {
            //  if(java.lang.Thread.interrupted()){
			// 	break;
			// }
            if (snatchSeq) {
                if (snatchIns) {
                    snatchId = itemArray[i].FreeUnitOrigin.OfferingKey.PurchaseSeq;
                } else {
                    snatchId = itemArray[i].OfferingKey.PurchaseSeq;
                }
            } else {
                if (snatchIns) {
                    snatchId = itemArray[i].FreeUnitOrigin.OfferingKey.OfferingID;
                } else {
                    snatchId = itemArray[i].OfferingKey.OfferingID;
                }
            }
            if (include) {
                if (existsOffer(offeringLst, snatchId)) {
                    snatchedInstances.push(itemArray[i]);
                }
            } else {
                if (!existsOffer(offeringLst, snatchId)) {
                    snatchedInstances.push(itemArray[i]);
                }
            }
        }
    } else {
        if (snatchSeq) {
            if (snatchIns) {
                snatchId = itemArray.FreeUnitOrigin.OfferingKey.PurchaseSeq;
            } else {
                snatchId = itemArray.OfferingKey.PurchaseSeq;
            }
        } else {
            if (snatchIns) {
                snatchId = itemArray.FreeUnitOrigin.OfferingKey.OfferingID;
            } else {
                snatchId = itemArray.OfferingKey.OfferingID;
            }
        }
        if (include) {
            if (existsOffer(offeringLst, snatchId)) {
                snatchedInstances.push(itemArray);
            }
        } else {
            if (!existsOffer(offeringLst, snatchId)) {
                snatchedInstances.push(itemArray);
            }
        }
    }
    return snatchedInstances;
}

function existsOffer(offerLst, offerSeq) {
    var flag = false;
    if (offerLst instanceof Array) {
        for (var i = 0; i < offerLst.length; i++) {
            //  if(java.lang.Thread.interrupted()){
			// 	break;
			// }
            if (offerLst[i] == offerSeq) {
                flag = true;
                break;
            }
        }
    } else {
        flag = offerLst == offerSeq;
    }
    return flag;
}

function setPackageItems(instances, queue) {
    var packItem;
    var tmpItem;
    var currentAmtBts = 0;
    var initialAmtBts = 0;
    var consumptionAmtBts = 0;
    var itmClass = !queue ? 'Vigente' : 'Pendiente';
    var itmOffer = '';
    var itmProduct = '';
    var itmPurchaseSeq = '';
    var itmName = '';
    var itmType = 'Paquete';
    var itmMeasure = 'MB';
    var itmServiceStart = '';
    var itmServiceEnd = '';
    var itmQtaPrcntg = '';
    var itmQtaValue = '';
    var itmQtaConsumption = '';
    var itmQtaBalance = '';
    if (instances instanceof Array) {
        packItem = new Array();
        for (var i = 0; i < instances.length; i++) {
            //  if(java.lang.Thread.interrupted()){
			// 	break;
			// }
            tmpItem = new Object();
            currentAmtBts = new Number(instances[i].CurrentAmount);
            initialAmtBts = new Number(instances[i].InitialAmount);
            consumptionAmtBts = initialAmtBts - currentAmtBts;
            itmOffer = instances[i].FreeUnitOrigin.OfferingKey.OfferingID;
            itmProduct = "0";
            itmPurchaseSeq = instances[i].FreeUnitOrigin.OfferingKey.PurchaseSeq;
            itmName = instances[i].FreeUnitOrigin.OfferingKey.OfferingName;
            itmServiceStart = instances[i].EffectiveTime;
            itmServiceEnd = instances[i].ExpireTime;
            itmQtaPrcntg = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
            itmQtaValue = getUnit(initialAmtBts, 'KB');
            itmQtaConsumption = getUnit(consumptionAmtBts, 'KB');
            itmQtaBalance = getUnit(currentAmtBts, 'KB');
            tmpItem = setItem(itmOffer, itmProduct, itmPurchaseSeq, itmName, itmType, itmMeasure, itmServiceStart,
                itmServiceEnd, itmQtaPrcntg, itmQtaValue, itmQtaConsumption, itmQtaBalance, itmClass, false, false, true);
            packItem.push(tmpItem);
        }
    } else {
        packItem = new Object();
        if (typeof (instances.CurrentAmount) != 'undefined') {
            currentAmtBts = new Number(instances.CurrentAmount);
            initialAmtBts = new Number(instances.InitialAmount);
            consumptionAmtBts = initialAmtBts - currentAmtBts;
            itmOffer = instances.FreeUnitOrigin.OfferingKey.OfferingID;
            itmProduct = "0";
            itmPurchaseSeq = instances.FreeUnitOrigin.OfferingKey.PurchaseSeq;
            itmName = instances.FreeUnitOrigin.OfferingKey.OfferingName;
            itmServiceStart = instances.EffectiveTime;
            itmServiceEnd = instances.ExpireTime;
            itmQtaPrcntg = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
            itmQtaValue = getUnit(initialAmtBts, 'KB');
            itmQtaConsumption = getUnit(consumptionAmtBts, 'KB');
            itmQtaBalance = getUnit(currentAmtBts, 'KB');
            packItem = setItem(itmOffer, itmProduct, itmPurchaseSeq, itmName, itmType, itmMeasure, itmServiceStart,
                itmServiceEnd, itmQtaPrcntg, itmQtaValue, itmQtaConsumption, itmQtaBalance, itmClass, false, false, true);
        }
    }
    return packItem;
}

//Funcion Planes VAS
function setPlanItems(instances, CbsCycle, queue) {
    var planItem = new Object();
    var tmpPlanItem = new Array();
    var tmpItem = new Object();
    var currentAmtBts = 0;
    var initialAmtBts = 0;
    var consumptionAmtBts = 0;
    //var itmClass = !queue ? 'Vigente' : 'Pendiente';
    var itmClass = 'Vigente';
    var itmOffer = '';
    var itmProduct = '';
    var itmPurchaseSeq = '';
    var itmName = '';
    var itmType = 'Plan';
    var itmMeasure = 'MB';
    var itmServiceStart = '';
    var itmServiceEnd = '';
    var itmQtaPrcntg = '';
    var itmQtaValue = '';
    var itmQtaConsumption = '';
    var itmQtaBalance = '';
    var itmBillCylcle = CbsCycle;
    if (instances instanceof Array) {
       
        for (var i = 0; i < instances.length; i++) {
            //  if(java.lang.Thread.interrupted()){
			// 	break;
			// }
            tmpItem = new Object();
            currentAmtBts = new Number(instances[i].CurrentAmount);
            initialAmtBts = new Number(instances[i].InitialAmount);
            consumptionAmtBts = initialAmtBts - currentAmtBts;
            itmOffer = instances[i].FreeUnitOrigin.OfferingKey.OfferingID;
            itmPurchaseSeq = instances[i].FreeUnitOrigin.OfferingKey.PurchaseSeq;
            //planItem.offering = itmOffer;
            //planItem.productId = "0";
            //planItem.purchase_seq = instances[i].FreeUnitOrigin.OfferingKey.PurchaseSeq;
            planItem.product_name = instances[i].FreeUnitOrigin.OfferingKey.OfferingName;
            planItem.type_name = itmType;
            //itmServiceStart = instances[i].EffectiveTime;
            //itmServiceEnd = instances[i].ExpireTime;
            planItem.service_start = itmBillCylcle != "-" ? getCycleDate(new Number(itmBillCylcle)) : itmBillCylcle;
            planItem.service_end = '-';
            itmQtaPrcntg = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
            itmQtaValue = getUnit(initialAmtBts, 'KB');
            itmQtaConsumption = getUnit(consumptionAmtBts, 'KB');
            itmQtaBalance = getUnit(currentAmtBts, 'KB');
            tmpItem.measure = itmMeasure;
            tmpItem.qta_balance = itmQtaBalance;
            tmpItem.qta_consumption = itmQtaConsumption;
            tmpItem.qta_value = itmQtaValue;
            tmpItem.qta_percentage = itmQtaPrcntg;
            //tmpItem = setItemPlanCBS(itmMeasure,itmQtaPrcntg, itmQtaValue, itmQtaConsumption, itmQtaBalance, itmClass, false, false, true);
            //planItem.push(tmpItem);
            if (itmOffer == vOfferingPlanVAS && itmPurchaseSeq == vPurchaseSeqVAS) {
                tmpPlanItem.push(tmpItem);
                break;
            }
            tmpItem = new Object();
        }
        planItem.quotas = tmpPlanItem;
    } else if (plMultiQuota){
        var planItem2=new Object();
        //tmpPlanItem = new Array();
        //tmpItem = new Object();
        if (typeof (instances.CurrentAmount) != 'undefined') {
            currentAmtBts = new Number(instances.CurrentAmount);
            initialAmtBts = new Number(instances.InitialAmount);
            consumptionAmtBts = initialAmtBts - currentAmtBts;
            itmOffer = instances.FreeUnitOrigin.OfferingKey.OfferingID;
            itmPurchaseSeq = instances.FreeUnitOrigin.OfferingKey.PurchaseSeq;
            //planItem.offering = instances.FreeUnitOrigin.OfferingKey.OfferingID;
            //planItem.productId = "0";
            //planItem.purchase_seq = instances.FreeUnitOrigin.OfferingKey.PurchaseSeq;
            // if (itmOffer == vOfferingPlanVAS && itmPurchaseSeq == vPurchaseSeqVAS) {
            planItem.product_name = instances.FreeUnitOrigin.OfferingKey.OfferingName;
            planItem.type_name = itmType;
            //itmServiceStart = instances.EffectiveTime;
            //itmServiceEnd = instances.ExpireTime;
            planItem.service_start = itmBillCylcle != "-" ? getCycleDate(new Number(itmBillCylcle)) : itmBillCylcle;
            planItem.service_end = '-';
            itmQtaPrcntg = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
            itmQtaValue = getUnit(initialAmtBts, 'KB');
            itmQtaConsumption = getUnit(consumptionAmtBts, 'KB');
            itmQtaBalance = getUnit(currentAmtBts, 'KB');
            planItem2.measure = itmMeasure;
            planItem2.qta_balance = itmQtaBalance;
            planItem2.qta_consumption = itmQtaConsumption;
            planItem2.qta_value = itmQtaValue;
            planItem2.qta_percentage = itmQtaPrcntg;
            tmpPlanItem.push(planItem2);
            //planItem = setItemPlanCBS(itmMeasure,itmQtaPrcntg, itmQtaValue, itmQtaConsumption, itmQtaBalance, itmClass, false, false, true);
            //}
        }
        planItem.quotas = tmpPlanItem;
    }
    else{
         if (typeof (instances.CurrentAmount) != 'undefined') {
            currentAmtBts = new Number(instances.CurrentAmount);
            initialAmtBts = new Number(instances.InitialAmount);
            consumptionAmtBts = initialAmtBts - currentAmtBts;
            itmOffer = instances.FreeUnitOrigin.OfferingKey.OfferingID;
            itmPurchaseSeq = instances.FreeUnitOrigin.OfferingKey.PurchaseSeq;
            //planItem.offering = instances.FreeUnitOrigin.OfferingKey.OfferingID;
            //planItem.productId = "0";
            //planItem.purchase_seq = instances.FreeUnitOrigin.OfferingKey.PurchaseSeq;
            // if (itmOffer == vOfferingPlanVAS && itmPurchaseSeq == vPurchaseSeqVAS) {
            planItem.product_name = instances.FreeUnitOrigin.OfferingKey.OfferingName;
            planItem.type_name = itmType;
            //itmServiceStart = instances.EffectiveTime;
            //itmServiceEnd = instances.ExpireTime;
            planItem.service_start = itmBillCylcle != "-" ? getCycleDate(new Number(itmBillCylcle)) : itmBillCylcle;
            planItem.service_end = '-';
            itmQtaPrcntg = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
            itmQtaValue = getUnit(initialAmtBts, 'KB');
            itmQtaConsumption = getUnit(consumptionAmtBts, 'KB');
            itmQtaBalance = getUnit(currentAmtBts, 'KB');
            planItem.measure = itmMeasure;
            planItem.qta_balance = itmQtaBalance;
            planItem.qta_consumption = itmQtaConsumption;
            planItem.qta_value = itmQtaValue;
            planItem.qta_percentage = itmQtaPrcntg;
         }

    }
    return planItem;
}

//Funcion Addons
function setAddonsItems(instances, CbsCycle, queue) {
    var addonItm = new Object();
    var addItem;
    var addItemT2;
    var tmpItem;
    var currentAmtBts = 0;
    var initialAmtBts = 0;
    var consumptionAmtBts = 0;
    //var itmClass = !queue ? 'Vigente' : 'Pendiente';
    var itmClass = 'Vigente';
    var itmOffer = '';
    var itmProduct = '';
    var itmPurchaseSeq = '';
    var itmName = '';
    var itmType = 'Addon';
    var itmMeasure = 'MB';
    var itmServiceStart = '';
    var itmServiceEnd = '';
    var itmQtaPrcntg = '';
    var itmQtaValue = '';
    var itmQtaConsumption = '';
    var itmQtaBalance = '';
    var itmBillCylcle = CbsCycle;
    if (instances instanceof Array) {
        addItem = new Array();
        if(instances.length>0){
        itmServiceStart = instances[instances.length - 1].EffectiveTime;
        itmServiceEnd = instances[0].ExpireTime;
        for (var i = 0; i < instances.length; i++) {
            //  if(java.lang.Thread.interrupted()){
			// 	break;
			// }
            tmpItem = new Object();
            //currentAmtBts = new Number(instances[i].CurrentAmount);
            currentAmtBts += new Number(instances[i].CurrentAmount);
            initialAmtBts += new Number(instances[i].InitialAmount);
            consumptionAmtBts = initialAmtBts - currentAmtBts;
            itmOffer = instances[i].FreeUnitOrigin.OfferingKey.OfferingID;
            //itmProduct = "0";
            //itmPurchaseSeq = instances[i].FreeUnitOrigin.OfferingKey.PurchaseSeq;
            if (typeof vAddonRetOffering != 'undefined') {
            if (itmOffer.indexOf(vAddonRetOffering) < 0) {
               // if (itmOffer == vAddonRetOffering) {
                    itmName += itmName == '' ? instances[i].FreeUnitOrigin.OfferingKey.OfferingName : ',' + instances[i].FreeUnitOrigin.OfferingKey.OfferingName;
                }
            } else {
                itmName += itmName == '' ? instances[i].FreeUnitOrigin.OfferingKey.OfferingName : ',' + instances[i].FreeUnitOrigin.OfferingKey.OfferingName;
            }
        }
        itmQtaPrcntg = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
        itmQtaValue = getUnit(initialAmtBts, 'KB');
        itmQtaConsumption = getUnit(consumptionAmtBts, 'KB');
        itmQtaBalance = getUnit(currentAmtBts, 'KB');
        addonItm.product_name = itmName;
        addonItm.type_name = itmType;
        addonItm.measure = itmMeasure;
        addonItm.service_start = itmServiceStart;
        addonItm.service_end = itmServiceEnd;
        addonItm.qta_balance = itmQtaBalance;
        addonItm.qta_consumption = itmQtaConsumption;
        addonItm.qta_value = itmQtaValue;
        if (vChannelPC == channelId) {
            addonItm.qta_percentage = String(new Number(itmQtaPrcntg) - 100);
            if (addonItm.qta_percentage < 0)
                addonItm.qta_percentage = String(new Number(addonItm.qta_percentage) * (-1));
        } else {
            addonItm.qta_percentage = itmQtaPrcntg;
        }
        }
    } else {
        itmServiceStart = instances.EffectiveTime;
        itmServiceEnd = instances.ExpireTime;
        tmpItem = new Object();
        //currentAmtBts = new Number(instances[i].CurrentAmount);
        currentAmtBts += new Number(instances.CurrentAmount);
        initialAmtBts += new Number(instances.InitialAmount);
        consumptionAmtBts = initialAmtBts - currentAmtBts;
        itmOffer = instances.FreeUnitOrigin.OfferingKey.OfferingID;
        //itmProduct = "0";
        //itmPurchaseSeq = instances[i].FreeUnitOrigin.OfferingKey.PurchaseSeq;
        if (typeof vAddonRetOffering != 'undefined') {
            if (itmOffer.indexOf(vAddonRetOffering) < 0) {
                //if (itmOffer == vAddonRetOffering) {
                itmName += itmName == '' ? instances.FreeUnitOrigin.OfferingKey.OfferingName : ',' + instances.FreeUnitOrigin.OfferingKey.OfferingName;
            }
        } else {
            itmName += itmName == '' ? instances.FreeUnitOrigin.OfferingKey.OfferingName : ',' + instances.FreeUnitOrigin.OfferingKey.OfferingName;
        }
        itmQtaPrcntg = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
        itmQtaValue = getUnit(initialAmtBts, 'KB');
        itmQtaConsumption = getUnit(consumptionAmtBts, 'KB');
        itmQtaBalance = getUnit(currentAmtBts, 'KB');
        addonItm.product_name = itmName;
        addonItm.type_name = itmType;
        addonItm.measure = itmMeasure;
        addonItm.service_start = itmServiceStart;
        addonItm.service_end = itmServiceEnd;
        addonItm.qta_balance = itmQtaBalance;
        addonItm.qta_consumption = itmQtaConsumption;
        addonItm.qta_value = itmQtaValue;
        if (vChannelPC == channelId) {
            addonItm.qta_percentage = String(new Number(itmQtaPrcntg) - 100);
            if (addonItm.qta_percentage < 0)
                addonItm.qta_percentage = String(new Number(addonItm.qta_percentage) * (-1));
        } else {
            addonItm.qta_percentage = itmQtaPrcntg;
        }
    }
    return addonItm;
}

/*Addons de Retenciones*/
function setRetAddon(instances) {
    var addonItm = new Object();
    var tmpAddon = new Object();
    if (typeof vAddonRetOffering != 'undefined' && typeof vAddonRetExpire != 'undefined') {
        tmpAddon = getAddRet(instances.addonsT2, vAddonRetOffering);
        if (typeof tmpAddon != 'undefined') {
            addonItm.product_name = tmpAddon.FreeUnitOrigin.OfferingKey.OfferingName;
            addonItm.type_name = 'Addon';
            addonItm.service_start = tmpAddon.EffectiveTime;
            addonItm.service_end = getRetEndDate(vAddonRetExpire);
        }
    }
    return addonItm;
}

function getRetEndDate(val) {
    //04/12/2017 23:59:13 
    var strDate = val.replace(/\D/g, ' ');
    var dateArray = strDate.split(' ');
    var day = padStr(dateArray[0], 2, '0', STR_PAD_LEFT);
    var year = dateArray[2];
    var month = padStr(dateArray[1], 2, '0', STR_PAD_LEFT);
    var hours = padStr(dateArray[3], 2, '0', STR_PAD_LEFT);
    var minutes = padStr(dateArray[4], 2, '0', STR_PAD_LEFT);
    var seconds = padStr(dateArray[5], 2, '0', STR_PAD_LEFT);
    var format = year + '' + month + '' + day + '' + hours + '' + minutes + '' + seconds;
    return format;
}

function getAddRet(addArray, addName) {
    var addItem;
   
    if (addArray instanceof Array) {
        for (var i = 0; i < addArray.length; i++) {
            if (addArray[i].FreeUnitOrigin.OfferingKey.OfferingID.indexOf(vAddonRetOffering) >= 0) {
                addItem = addArray[i];
                break;
            }
        }
    } else {
        if(typeof (addArray.FreeUnitOrigin)!= 'undefined'){
        if (addArray.FreeUnitOrigin.OfferingKey.OfferingID.indexOf(vAddonRetOffering) >= 0) {
            addItem = addArray;
        }
        }
    }
    
    
    return addItem;
}
/*Fin Retenciones*/

function getCycleDate(billingDay) {
    var vNow = new Date(vSysDate.getTime());
    var addMonth = true;
    var vMonth = '0';
    var vAdd = billingDay > 1 ? 2 : 1;
    if (vNow.getDate() > billingDay) {
        vNow.setMonth(vNow.getMonth() + vAdd);
        addMonth = false;
    }
    vMonth = addMonth ? String((vNow.getMonth() + 1)) : String(vNow.getMonth());
    vNow.setDate(billingDay - 1);
    return padStr(vNow.getFullYear(), 4, '0', STR_PAD_LEFT) + '' + padStr(vMonth, 2, '0', STR_PAD_LEFT) + '' + padStr(String(vNow.getDate()), 2, '0', STR_PAD_LEFT) + '' + padStr(String(23), 2, '0', STR_PAD_LEFT) + '' + padStr(String(59), 2, '0', STR_PAD_LEFT) + '' + padStr(String(59), 2, '0', STR_PAD_LEFT);
}

function setItem(pOffering, pProduct, pPurchaseSeq, pName, pType, pMeasure, pServiceStart,
    pServiceEnd, pQtaPcntg, pQtaValue, pQtaConsumption, pQtaBalance, pClass, isApp, addActive, pActive) {
    var objItem = new Object();
    objItem.offering = pOffering;
    objItem.productId = pProduct;
    objItem.purchase_seq = pPurchaseSeq;
    objItem.product_name = pName;
    objItem.type_name = pType;
    objItem.measure = pMeasure;
    objItem.service_start = pServiceStart;
    objItem.service_end = pServiceEnd;
    if (!isApp) {
        objItem.qta_percentage = pQtaPcntg;
        objItem.qta_value = pQtaValue;
        objItem.qta_consumption = pQtaConsumption;
        objItem.qta_balance = pQtaBalance;
    } else {
        objItem.hour_percentage = pQtaPcntg;
        objItem.total_hours = pQtaValue;
        objItem.hours_consumed = pQtaConsumption;
        objItem.hours_remaining = pQtaBalance;
    }
    if (addActive) {
        objItem.active = pActive;
    }
    objItem["class"] = pClass;
    return objItem;
}

function setItemSubs(pOffering, pProduct, pPurchaseSeq, pName, pType, pMeasure, pServiceStart,
    pServiceEnd, pQtaPcntg, pQtaValue, pQtaConsumption, pQtaBalance, pClass, isApp, addActive, pActive) {
    var objItem = new Object();
    objItem.offering = pOffering;
    objItem.productId = pProduct;
    objItem.purchase_seq = pPurchaseSeq;
    objItem.product_name = pName;
    objItem.type_name = pType;
    objItem.measure = pMeasure;
    objItem.service_start = pServiceStart;
    objItem.next_renewal = pServiceEnd;
    if (!isApp) {
        objItem.qta_percentage = pQtaPcntg;
        objItem.qta_value = pQtaValue;
        objItem.qta_consumption = pQtaConsumption;
        objItem.qta_balance = pQtaBalance;
    } else {
        objItem.hour_percentage = pQtaPcntg;
        objItem.total_hours = pQtaValue;
        objItem.hours_consumed = pQtaConsumption;
        objItem.hours_remaining = pQtaBalance;
    }
    if (addActive) {
        objItem.active = pActive;
    }
    objItem["class"] = pClass;
    return objItem;
}

function getUnit(val, unit) {
    var btKb = 1024;
    var kbMb = 1024;
    var valMB = '0';
    switch (unit) {
        case "BT":
            valMB = String(new Number(Math.ceil((val / 1024) / 1024)).toFixed(2));
            break;
        case "KB":
            valMB = String(new Number(Math.ceil(val / 1024).toFixed(2)));
            break;
        default:
            valMB = String(val);
            break;
    }
    return valMB;
}

function setPackage(pInstances) {
    var packItem = new Object();
    packItem.active = setPackageItems(pInstances.active, false);
    packItem.queued = setPackageItems(pInstances.queued, true);
    return packItem;
}

function setPlanCBS(pInstances, vCycle) {
    var planItem = new Object();
    //planItem.active = setPlanItems(pInstances.active,vCycle,false);
    //planItem.queued = setPlanItems(pInstances.queued,vCycle,true);
    planItem = setPlanItems(pInstances.active, vCycle, false);
    return planItem;
}

function setAddCBS(pInstances, vCycle) {
    var addItem = new Object();
    addItem = setAddonsItems(pInstances.addons, vCycle, false);
    //addItem.queued = setAddonsItems(pInstances.queued, vCycle, true);
    return addItem;
}

function setApplications(pInstances) {
    var appItem = new Object();
    appItem.active = setAppItems(pInstances.active, false);
    appItem.queued = setAppItems(getSortedItems(pInstances.queued), true);
    return appItem;
}

function splitApps(itemArray) {
    var appArray = new Array();
    var tmpArray;
    var bustedOffers = new Array();
    var tmpId;
    for (var i = 0; i < itemArray.length; i++) {
        //  if(java.lang.Thread.interrupted()){
		// 		break;
		// 	}
        tmpId = itemArray[i].OfferingKey.OfferingID;
        if (!existsOffer(bustedOffers, tmpId)) {
            bustedOffers.push(tmpId);
            LOGGER.info('tmpId:' + tmpId);
            tmpArray = getSortedItems(snatchInstances(itemArray, tmpId, true, false, false));
            LOGGER.info('tmpArray:' + tmpArray.length);
            if (tmpArray.length > 0) {
                appArray.push(tmpArray);
            }
        }
    }
    //LOGGER.info('appArray:' + JSON.stringify(appArray));
    return appArray;
}

function splitOffers(pApps, pActiveIds) {
    var appItem = new Object();
    var activeOffers = new Array();
    var queuedOffers = new Array();
    var tmpArray;
    for (var i = 0; i < pApps.length; i++) {
        //  if(java.lang.Thread.interrupted()){
		// 		break;
		// 	}
        tmpArray = pApps[i];
        for (var j = 0; j < tmpArray.length; j++) {
            if (existsOffer(pActiveIds, tmpArray[j].OfferingKey.PurchaseSeq)) {
                activeOffers.push(tmpArray[j]);
            } else {
                queuedOffers.push(tmpArray[j]);
            }
        }
    }
    appItem.active = activeOffers;
    appItem.queued = queuedOffers;
    return appItem;
}

function setAppItems(instances, queue) {
    var packItem;
    var tmpItem;
    var currentAmtBts = 0;
    var initialAmtBts = 0;
    var consumptionAmtBts = 0;
    var itmClass = !queue ? 'Vigente' : 'Pendiente';
    var itmOffer = '';
    var itmProduct = '';
    var itmPurchaseSeq = '';
    var itmName = '';
    var itmType = 'Aplicacion';
    var itmMeasure = 'Hrs';
    var itmServiceStart = '';
    var itmServiceEnd = '';
    var itmQtaPrcntg = '';
    var itmQtaValue = '';
    var itmQtaConsumption = '';
    var itmQtaBalance = '';
    if (instances instanceof Array) {
        packItem = new Array();
        for (var i = 0; i < instances.length; i++) {
            //  if(java.lang.Thread.interrupted()){
			// 	break;
			// }
            tmpItem = new Object();
            itmServiceStart = instances[i].EffectiveTime;
            itmServiceEnd = instances[i].ExpirationTime;
            currentAmtBts = getHoursDiff(itmServiceStart, itmServiceEnd, true);
            initialAmtBts = getHoursDiff(itmServiceStart, itmServiceEnd, false);
            consumptionAmtBts = initialAmtBts - currentAmtBts;
            itmOffer = typeof (instances[i].OfferingKey) != 'undefined' ? instances[i].OfferingKey.OfferingID : '0';
            itmProduct = typeof (instances[i].productId) != 'undefined' ? instances[i].productId : '0';
            itmPurchaseSeq = typeof (instances[i].OfferingKey) != 'undefined' ? instances[i].OfferingKey.PurchaseSeq : '0';
            itmName = instances[i].offerName;
            itmQtaPrcntg = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
            itmQtaValue = getUnit(initialAmtBts, 'HR');
            itmQtaConsumption = getUnit(consumptionAmtBts, 'HR');
            itmQtaBalance = getUnit(currentAmtBts, 'HR');
            tmpItem = setItem(itmOffer, itmProduct, itmPurchaseSeq, itmName, itmType, itmMeasure, itmServiceStart,
                itmServiceEnd, itmQtaPrcntg, itmQtaValue, itmQtaConsumption, itmQtaBalance, itmClass, true, false, true);
            packItem.push(tmpItem);
        }
    } else {
        packItem = new Object();
        if (typeof (instances.CurrentAmount) != 'undefined') {
            itmServiceStart = instances.EffectiveTime;
            itmServiceEnd = instances.ExpirationTime;
            currentAmtBts = getHoursDiff(itmServiceStart, itmServiceEnd, true);
            initialAmtBts = getHoursDiff(itmServiceStart, itmServiceEnd, false);
            consumptionAmtBts = initialAmtBts - currentAmtBts;
            itmOffer = typeof (instances.OfferingKey) != 'undefined' ? instances.OfferingKey.OfferingID : '0';
            itmProduct = typeof (instances.productId) != 'undefined' ? instances.productId : '0';
            itmPurchaseSeq = typeof (instances.OfferingKey) != 'undefined' ? instances.OfferingKey.PurchaseSeq : '0';
            itmName = instances.offerName;
            itmQtaPrcntg = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
            itmQtaValue = getUnit(initialAmtBts, 'HR');
            itmQtaConsumption = getUnit(consumptionAmtBts, 'HR');
            itmQtaBalance = getUnit(currentAmtBts, 'HR');
            packItem = setItem(itmOffer, itmProduct, itmPurchaseSeq, itmName, itmType, itmMeasure, itmServiceStart,
                itmServiceEnd, itmQtaPrcntg, itmQtaValue, itmQtaConsumption, itmQtaBalance, itmClass, true, false, true);
        }
    }
    return packItem;
}

function getHoursDiff(pIni, pFin, sysdate) {
    var initialDate = !sysdate ? getCbsDate(pIni) : new Date();
    var endDate = getCbsDate(pFin);
    var vDiffMillis = Math.abs(endDate.getTime() - initialDate.getTime());
    var vHourDiff = Math.ceil(vDiffMillis / (60 * 60 * 1000))
    return vHourDiff;
}

function getActiveApps(pArray) {
    var activeArray = new Array();
    for (var i = 0; i < pArray.length; i++) {
        //  if(java.lang.Thread.interrupted()){
		// 		break;
		// 	}
        if (pArray[i] instanceof Array) {
            activeArray.push(pArray[i][0].OfferingKey.PurchaseSeq);
        } else {
            activeArray.push(pArray[i].OfferingKey.PurchaseSeq);
        }
    }
    return activeArray;
}
//


//JSON.Parse
    var doubleQuote = '"';
var regExpQuotes = /'/g;
var vJson = '';
var vQueryOfferingObjects = '';

if (typeof vQueryOffering != 'undefined') {
	vJson = "{" + vQueryOffering.replace(regExpQuotes, doubleQuote) + "}";
	vQueryOfferingObjects = JSON.parse(vJson);
}
//

//ProcessOffering
    var actOfferItem = new Object();
var actOfferId = '0';

var actOfferItemPrimary=new Object();
var actOfferIdPrimary='0';


if(navObject.offeringJson.filled){
    
    doLoop = forCounter < supplementaryOffers.length;
       //doLoop=true;
    
    if(doLoop){
        actOfferItem = supplementaryOffers[forCounter];

        if(typeof(actOfferItem.OfferingKey) != 'undefined'){
            actOfferId = actOfferItem.OfferingKey.OfferingID;
        }
    } else {
        forCounter = 0;
        enrichedOfferings.appOfferings = getSortedItems(enrichedOfferings.appOfferings);
        enrichedOfferings.susOfferings = getSortedItems(enrichedOfferings.susOfferings);
        enrichedOfferings.cmbOfferings = getSortedItems(enrichedOfferings.cmbOfferings);
        //enrichedOfferings.planOfferings = getSortedItems(enrichedOfferings.planOfferings);
        //enrichedOfferings.addonsOfferings=getSortedItems(enrichedOfferings.addonsOfferings);
    }
}



//

while(doLoop){
    //EnrichOffering
        //actOfferId: offering de cbs
//var vQueryOffering
var vOfferingItem = '';

actOfferItem.productId = "0";
actOfferItem.offerType = "NA";
actOfferItem.offerName = "NA";
actOfferItem.productProfile = "0";
actOfferItem.productQta = "0";
actOfferItem.isPackage = false;

if (typeof vQueryOfferingObjects != 'undefined') {
    vOfferingItem = vQueryOfferingObjects[actOfferId];
    if (typeof vOfferingItem != 'undefined') {
        actOfferItem.productId = vOfferingItem.PRODUCT_ID;
        actOfferItem.offerType = vOfferingItem.TYPE;
        actOfferItem.offerName = vOfferingItem.PRODUCT_NAME;
        actOfferItem.productProfile = vOfferingItem.PROFILE;
        actOfferItem.productQta = vOfferingItem.QTA;
        actOfferItem.isPackage = vOfferingItem.PACKAGE == 'TRUE' ? true : false;
    }
} 

// else {
//     actOfferItem.productId = "0";
//     actOfferItem.offerType = "NA";
//     actOfferItem.offerName = "NA";
//     actOfferItem.productProfile = "0";
//     actOfferItem.productQta = "0";
//     actOfferItem.isPackage = false;
// }


var cnfProductId = "0";
var cnfType = "NA";
var cnfProductName = "NA";
var cnfProfile = "0";
var cnfQta = "0";
var cnfPck = "FALSE";


enrichedOfferings = setEnrichment(enrichedOfferings, actOfferItem);
forCounter++;
    //

//ProcessOffering
    var actOfferItem = new Object();
var actOfferId = '0';

var actOfferItemPrimary=new Object();
var actOfferIdPrimary='0';


if(navObject.offeringJson.filled){
    
    doLoop = forCounter < supplementaryOffers.length;
       //doLoop=true;
    
    if(doLoop){
        actOfferItem = supplementaryOffers[forCounter];

        if(typeof(actOfferItem.OfferingKey) != 'undefined'){
            actOfferId = actOfferItem.OfferingKey.OfferingID;
        }
    } else {
        forCounter = 0;
        enrichedOfferings.appOfferings = getSortedItems(enrichedOfferings.appOfferings);
        enrichedOfferings.susOfferings = getSortedItems(enrichedOfferings.susOfferings);
        enrichedOfferings.cmbOfferings = getSortedItems(enrichedOfferings.cmbOfferings);
        //enrichedOfferings.planOfferings = getSortedItems(enrichedOfferings.planOfferings);
        //enrichedOfferings.addonsOfferings=getSortedItems(enrichedOfferings.addonsOfferings);
    }
}



//

}

//SetBundles
    var bundlePackOffers = new Array();
var bundlePlanOffers=new Array();
var bundleAppOffers = new Array();
var bundlePackChildOffers = new Array();
var bundlePlanChildOffers=new Array();
var bundleAppChildOffers = new Array();
var bundles = new Array();
var bundle;
var bndlIdntfr = 'cmb';
var bndlPropName = 'C_REMARKS2';
var cmbOffers;

if(enrichedOfferings.cmbOfferings.length > 0 && !vSkipBundle){
    cmbOffers = enrichedOfferings.cmbOfferings;
    for(var i = 0; i < cmbOffers.length; i++){
        bundle = setItem(cmbOffers[i].OfferingKey.OfferingID, cmbOffers[i].productId, cmbOffers[i].OfferingKey.PurchaseSeq, 
                cmbOffers[i].offerName, cmbOffers[i].offerType, 'Cmb', '-', 
                '-', '-', '-', '-', '-', 'Vigente');
        bundlePackOffers = findChildren(cmbOffers[i].OfferingKey.PurchaseSeq, bndlIdntfr, enrichedOfferings.packOfferings);
        bundlePackOffers = bundlePackOffers.
            concat(findChildren(cmbOffers[i].OfferingKey.PurchaseSeq, bndlIdntfr, enrichedOfferings.undefOfferings));
        bundleAppOffers = findChildren(cmbOffers[i].OfferingKey.PurchaseSeq, bndlIdntfr, enrichedOfferings.appOfferings);
        //LOGGER.info('paquetes:' + bundlePackOffers.join());
        if(cmbOffers[i].isPackage){
            bundlePackOffers.push(cmbOffers[i].OfferingKey.PurchaseSeq);  
        }

        bundlePackChildOffers = bundlePackChildOffers.concat(bundlePackOffers);
        bundleAppChildOffers = bundleAppChildOffers.concat(bundleAppOffers);

        if(typeof(packageWallet) != 'undefined' && bundlePackOffers.length > 0){
            packInstances = getSortedItems(snatchInstances(packageWallet.FreeUnitItemDetail, bundlePackOffers, true, true, true));
            tmpInstances = splitInstances(packInstances, activePackSeq);
            bundle.packages = setPackage(tmpInstances);
        } else {
            bundle.packages = new Object();
        }

        if(enrichedOfferings.appOfferings.length > 0 && bundleAppOffers.length > 0){
            activeAppsSeq = getActiveApps(splitApps(enrichedOfferings.appOfferings));
            packInstances = snatchInstances(enrichedOfferings.appOfferings, bundleAppOffers, true, false, true);
            bundle.applications = setApplications(splitOffers(splitApps(packInstances), activeAppsSeq));
        } else{
            bundle.applications = new Object();
        }
        //if(bundlePackOffers.length > 0 || bundleAppOffers.length > 0){
            //bundles.push(bundle);
        //}
        var  vPushBundle = false;
        if (typeof bundle.packages.active != 'undefined' && typeof bundle.packages.active.offering != 'undefined') {
            vPushBundle = true;
        }
        if (typeof bundle.packages.queued != 'undefined') {
            if (bundle.packages.queued instanceof Array && typeof bundle.packages.queued[0] != 'undefined'){
                vPushBundle = true;
            }
            else {
                if (typeof bundle.packages.queued.offering != 'undefined') {
                    vPushBundle = true;
                }
            }
        } 
        if (typeof bundle.applications.active != 'undefined') {
            if (bundle.applications.active instanceof Array && typeof bundle.applications.active[0] != 'undefined'){
                vPushBundle = true;
            }
            else {
                if (typeof bundle.applications.active.offering != 'undefined') {
                    vPushBundle = true;
                }
            }
        }
        if (typeof bundle.applications.queued != 'undefined') {
            if (bundle.applications.queued instanceof Array && typeof bundle.applications.queued[0] != 'undefined'){
                vPushBundle = true;
            }
            else {
                if (typeof bundle.applications.queued.offering != 'undefined') {
                    vPushBundle = true;
                }
            }
        }        
        if (vPushBundle) {
            bundles.push(bundle);
        }
    }
}


function findChildren(parentOffer, idntfr, offerItem){
    var children = new Array();
    var remarkProp;
    LOGGER.info('JSON: ' + JSON.stringify(offerItem));
    for(var i = 0; i < offerItem.length; i++){
        if(typeof(offerItem[i].OInstProperty) != 'undefined' && typeof(offerItem[i].OfferingKey) != 'undefined'){
            remarkProp = getProperty(offerItem[i].OInstProperty, bndlPropName);
            LOGGER.info('remarkProp: ' + JSON.stringify(remarkProp));
            if(typeof(remarkProp) != 'undefined'){
                LOGGER.info('parentOffer: ' + parentOffer);
                if(isParent(parentOffer, idntfr, remarkProp)){
                    children.push(offerItem[i].OfferingKey.PurchaseSeq)
                }
            }
        }
    }
    return children;
}


function isParent(parentId, transIdntfr, childRemark){
    var remarkArray = childRemark.Value.split(';');
    var identifier = remarkArray[0];
    var flag = false;
    if(identifier.toLowerCase() == transIdntfr && remarkArray.length > 1){
        flag = parentId == remarkArray[1];
    }
    return flag;
}


function getProperty(propArray, propName){
    var propItem;
    if(propArray instanceof Array){
        for(var i = 0; i < propArray.length; i++){
            if(propArray[i].PropCode == propName){
                propItem = propArray[i];
                break;
            }
        }
    } else {
        if(propArray.PropCode == propName){
            propItem = propArray;
        }
    }
    return propItem;
}
//


//SetPackages
    var packages = new Object();
if(typeof(packageWallet) != 'undefined'){
    packInstances = getSortedItems(snatchInstances(packageWallet.FreeUnitItemDetail, bundlePackChildOffers, false, true, true));
    tmpInstances = splitInstances(packInstances, activePackSeq);
    packages = setPackage(tmpInstances);
} else {
    packages.active = new Object();
    packages.queued = new Array();
}
//


//SetApplication
    var applications = {active: [], queued: []};
var appOffers;
var tmpApp = {active: [], queued: []};
var tmpItem;
if(enrichedOfferings.appOfferings.length > 0){
    if(vUnifyApps){
        if(navObject.pccJson.filled){
            if(typeof(navObject.pccJson.obj.Applications) != 'undefined'){
                for(var i = 0; i < navObject.pccJson.obj.Applications.length; i++){
                    tmpItem = new Object();
                    tmpItem.EffectiveTime = String(navObject.pccJson.obj.Applications[i].ServiceStartDate);
                    tmpItem.ExpirationTime = String(navObject.pccJson.obj.Applications[i].ServiceEndDate);
                    tmpItem.offerName = navObject.pccJson.obj.Applications[i].ProductName;
                    tmpApp.active.push(tmpItem);
                }
                applications = setApplications(tmpApp);
            }
        }
    } else {
        activeAppsSeq = getActiveApps(splitApps(enrichedOfferings.appOfferings));
        //LOGGER.info('active apps: ' + activeAppsSeq.join());
        appOffers = snatchInstances(enrichedOfferings.appOfferings, bundleAppChildOffers, false, false, true);
        //LOGGER.info('appOffers: ' + JSON.stringify(appOffers));
        applications = setApplications(splitOffers(splitApps(appOffers), activeAppsSeq));
    }
}
//


//processSubscriptions
    
//


//setAddons
    var addons = new Object();
var addonsT2 = new Object();
var vHasAddons=false;
var vHasAddonsT2=false;

if(navObject.pccJson.filled){
    if(typeof(navObject.pccJson.obj.Addons) != 'undefined'){
        if(navObject.pccJson.obj.Addons.length > 0){
            addons = unifyAddons(navObject.pccJson.obj.Addons);
            addonsT2 = setRetAddonPCC(navObject.pccJson.obj.Addons);
        }
    }
}

if(typeof addons.qta_balance != 'undefined'){
    if(parseInt(addons.qta_balance)>0){
        vHasAddons=true;
    }
}
if (typeof addonsT2.product_name != 'undefined'){
        vHasAddonsT2=true;
}

function setRetAddonPCC(addArray){
    var addonItm = new Object();
    var tmpAddon = new Object();
    if(typeof vAddonRetEntitlement != 'undefined' && typeof vAddonRetExpire != 'undefined'){
        tmpAddon = getAddRetPCC(addArray, vAddonRetEntitlement);
        if(typeof tmpAddon != 'undefined'){
            addonItm.product_name = tmpAddon.ProductName;
            addonItm.type_name = 'Addon';
            addonItm.service_start = tmpAddon.itmServiceStart;
            addonItm.service_end = getRetEndDate(vAddonRetExpire);
        }
    }
    return addonItm;
}

function getRetEndDate(val){
    //04/12/2017 23:59:13 
    var strDate = val.replace(/\D/g,' ');
    var dateArray = strDate.split(' ');
    var day = padStr(dateArray[0], 2, '0', STR_PAD_LEFT);
    var year = dateArray[2];
    var month = padStr(dateArray[1], 2, '0', STR_PAD_LEFT);
    var hours = padStr(dateArray[3], 2, '0', STR_PAD_LEFT);
    var minutes = padStr(dateArray[4], 2, '0', STR_PAD_LEFT);
    var seconds = padStr(dateArray[5], 2, '0', STR_PAD_LEFT);
    var format = year + '' + month + '' + day + '' + hours + '' + minutes + '' + seconds;
    return format;
}

function getAddRetPCC(addArray, addName){
    var addItem;
    for(var i = 0; i < addArray.length; i++){
        if(addArray[i].ServiceName.indexOf(vAddonRetEntitlement) >= 0){
            addItem = addArray[i];
            break;
        }
    }
    return addItem;
}

function unifyAddons(addArray){
    var addonItm = new Object();
    var currentAmtBts = 0;
    var initialAmtBts = 0;
    var consumptionAmtBts = 0;
    var itmClass = 'Vigente';
    var itmName = '';
    var itmType = 'Addon';
    var itmMeasure = 'MB';
    var itmServiceStart = '';
    var itmServiceEnd = '';
    var itmQtaPrcntg = '';
    var itmQtaValue = '';
    var itmQtaConsumption = '';
    var itmQtaBalance = '';
    if(addArray.length > 0){
        itmServiceStart = addArray[addArray.length - 1].ServiceStartDate;
        itmServiceEnd = addArray[0].ServiceEndDate;
        for(var i = 0; i < addArray.length; i++){
            currentAmtBts += new Number(addArray[i].QuotaBalanceMb);
            initialAmtBts += new Number(addArray[i].QuotaValueMb);
            consumptionAmtBts += new Number(addArray[i].QuotaConsumptionMb);
            if(typeof vAddonRetEntitlement != 'undefined'){
                if(addArray[i].ServiceName.indexOf(vAddonRetEntitlement) < 0){
                    itmName += itmName == '' ? addArray[i].ProductName : ',' + addArray[i].ProductName;
                }
            } else {
                itmName += itmName == '' ? addArray[i].ProductName : ',' + addArray[i].ProductName;
            }
        }
        itmQtaBalance = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
        addonItm.product_name = itmName;
        addonItm.type_name = itmType;
        addonItm.measure = itmMeasure;
        addonItm.service_start = itmServiceStart;
        addonItm.service_end = itmServiceEnd;
        addonItm.qta_balance = getUnit(currentAmtBts, 'MB');
        addonItm.qta_consumption = getUnit(consumptionAmtBts, 'MB');
        addonItm.qta_value = getUnit(initialAmtBts, 'MB');
        if (vChannelPC == channelId) {     
            addonItm.qta_percentage = String(new Number(itmQtaBalance) - 100);
            if (addonItm.qta_percentage < 0)
                addonItm.qta_percentage = String(new Number(addonItm.qta_percentage) * (-1));
        }
        else 
            addonItm.qta_percentage = itmQtaBalance;
    }

   
    return addonItm;
}
//

//setPlan
    var plan = new Object();
var user = new Object();
var vHasPCCPlan=false;

if(navObject.pccJson.filled){
    if(typeof(navObject.pccJson.obj.Plans) != 'undefined'){
        plan = setPlan(navObject.pccJson.obj.Plans);
    }

    if(typeof plan.quotas != 'undefined'){
        for(var k=0;k<plan.quotas.length;k++){
            if(parseInt(plan.quotas[k].qta_balance)>0){
                vHasPCCPlan=true;
            }
        
        }
    }else if(parseInt(plan.qta_balance)>0){
        vHasPCCPlan=true;

    }

        
    if(typeof(navObject.pccJson.obj.User) != 'undefined'){
        user.subscriberId = subscriberId.toString();
        user.billCycle = navObject.pccJson.obj.User.SubscriberBillCycle.toString();
    }
}

function setPlan(pItem){
    var plItem = new Object();
    var tmpQuotaItem = new Object();
    var tmpQuotasArray = new Array();
    var currentAmtBts = 0;
    var initialAmtBts = 0;
    var consumptionAmtBts = 0;
    var itmClass = 'Vigente';
    var itmName = '';
    var itmType = 'Plan';
    var itmMeasure = 'MB';
    var itmServiceStart = '';
    var itmServiceEnd = '';
    var itmQtaPrcntg = '';
    var itmQtaValue = '';
    var itmQtaConsumption = '';
    var itmQtaBalance = '';
    var billCycle = typeof(navObject.pccJson.obj.User.SubscriberBillCycle) != 'undefined' ? navObject.pccJson.obj.User.SubscriberBillCycle : "-";
    itmServiceStart = pItem.ServiceStartDate;
    itmServiceEnd = pItem.ServiceEndDate;
    itmName = pItem.ProductName;
    plItem.product_name = itmName;
    plItem.type_name = itmType;
    plItem.service_start = billCycle != "-" ? getCycleDate(new Number(billCycle)) : billCycle;
    plItem.service_end = "-";

    if(typeof pItem.Quotas == 'undefined'){
        currentAmtBts = new Number(pItem.QuotaBalanceMb);
        initialAmtBts = new Number(pItem.QuotaValueMb);
        consumptionAmtBts = new Number(pItem.QuotaConsumptionMb);
        itmQtaBalance = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
        plItem.measure = itmMeasure;
        plItem.qta_balance = getUnit(currentAmtBts, 'MB');
        plItem.qta_consumption = getUnit(consumptionAmtBts, 'MB');
        plItem.qta_value = getUnit(initialAmtBts, 'MB');
        plItem.qta_percentage = itmQtaBalance;
    } else {
        for(var i = 0; i < pItem.Quotas.length; i++){
            currentAmtBts = new Number(pItem.Quotas[i].QuotaBalanceMb);
            initialAmtBts = new Number(pItem.Quotas[i].QuotaValueMb);
            consumptionAmtBts = new Number(pItem.Quotas[i].QuotaConsumptionMb);
            itmQtaBalance = String(new Number((currentAmtBts / initialAmtBts) * 100).toFixed(2));
            tmpQuotaItem.measure = itmMeasure;
            tmpQuotaItem.qta_balance = getUnit(currentAmtBts, 'MB');
            tmpQuotaItem.qta_consumption = getUnit(consumptionAmtBts, 'MB');
            tmpQuotaItem.qta_value = getUnit(initialAmtBts, 'MB');
            tmpQuotaItem.qta_percentage = itmQtaBalance;
            tmpQuotasArray.push(tmpQuotaItem);
            tmpQuotaItem = new Object();
        }
        plItem.quotas = tmpQuotasArray;
    }
    return plItem;
}

function getCycleDate(billingDay){
    var vNow = new Date(vSysDate.getTime());
    var addMonth = true;
    var vMonth = '0';
    var vAdd = billingDay > 1 ? 2 : 1;
    if(vNow.getDate() > billingDay){
        vNow.setMonth(vNow.getMonth() + vAdd);
        addMonth = false;
    }
    vMonth = addMonth ? String((vNow.getMonth() + 1)) : String(vNow.getMonth());
    vNow.setDate(billingDay - 1);
    return padStr(vNow.getFullYear(), 4, '0', STR_PAD_LEFT) + '' + padStr(vMonth, 2, '0', STR_PAD_LEFT) + '' + padStr(String(vNow.getDate()), 2, '0', STR_PAD_LEFT) + '' + padStr(String(23), 2, '0', STR_PAD_LEFT) + '' + padStr(String(59), 2, '0', STR_PAD_LEFT) + '' + padStr(String(59), 2, '0', STR_PAD_LEFT);
}
//

//setAddonsCBSWL
    /*****************************Addons CBS************************/
if (typeof vHasAddons == 'undefined') {
    var addons = new Object();
} 
if (typeof vHasAddonsT2 =='undefined') {
    var addonsT2 = new Object();
}

if (vSubscriberType != 'PRE') {
    if (typeof (addonWallet) != 'undefined') {
        if (typeof vAddonRetOffering != 'undefined') {
            activeAddSeq = vAddonRetOffering;
        } else {
            activeAddSeq = '';
        }
        addInstances = getSortedItems(snatchInstances(addonWallet.FreeUnitItemDetail, bundlePackChildOffers, false, true, true));
        tmpInstances_add = splitInstancesAddons(addInstances, activeAddSeq);

        if (typeof vHasAddons =='undefined'){
            addons = setAddCBS(tmpInstances_add, planBillCycle);
        }else if(!vHasAddons){
            addons = setAddCBS(tmpInstances_add, planBillCycle);
        }
        
        if (typeof vHasAddonsT2 == 'undefined') {
            addonsT2 = setRetAddon(tmpInstances_add);
        }else if(!vHasAddonsT2){
            addonsT2 = setRetAddon(tmpInstances_add);
        }
    }
}
/**************************************************************/

//

//validaPrimary
    var vIsPrimaryPlan=true;


if(typeof vOfferingPlanVAS != 'undefined' && vOfferingPlanVAS != 'NA'){
	vIsPrimaryPlan=false;
}


//

//setPlanCBSWL
    if (typeof vHasPCCPlan == 'undefined') {


    // var plan = new Object();
    // var user = new Object();

    if (vSubscriberType != 'PRE') {
        if (!vIsPrimaryPlan) {
            if (typeof (planWallet) != 'undefined') {
                var plan = new Object();
                var user = new Object();
                activePlanSeq = vPurchaseSeqVAS;
                planInstances = getSortedItemsPospaid(snatchInstances(planWallet.FreeUnitItemDetail, bundlePlanChildOffers, false, true, false));
                tmpInstances_plan = splitInstancesPlan(planInstances, activePlanSeq);
                plan = setPlanCBS(tmpInstances_plan, planBillCycle);
            }
        } else {
            if (typeof (planWallet) != 'undefined') {
                var plan = new Object();
                var user = new Object();
                planInstances = getSortedItemsPospaid(snatchInstances(planWallet.FreeUnitItemDetail, bundlePlanChildOffers, false, true, false));
                tmpInstances_plan = splitInstancesPlan(planInstances, activePlanSeq);
                plan = setPlanCBS(tmpInstances_plan, planBillCycle);
            }

        }
    }



    if (navObject.offeringJson.filled) {
        if (typeof (planBillCycle) != 'undefined') {
            user.subscriberId = subscriberId.toString();
            user.billCycle = parseInt(planBillCycle).toString();
            //user.billCycle = planBillCycle;
        }
    }

}

else if(!vHasPCCPlan){
        // var plan = new Object();
        // var user = new Object();

    if (vSubscriberType != 'PRE') {
        if (!vIsPrimaryPlan) {
            if (typeof (planWallet) != 'undefined') {
                var plan = new Object();
                var user = new Object();
                activePlanSeq = vPurchaseSeqVAS;
                planInstances = getSortedItemsPospaid(snatchInstances(planWallet.FreeUnitItemDetail, bundlePlanChildOffers, false, true, false));
                tmpInstances_plan = splitInstancesPlan(planInstances, activePlanSeq);
                plan = setPlanCBS(tmpInstances_plan, planBillCycle);
            }
        } else {
            if (typeof (planWallet) != 'undefined') {
                var plan = new Object();
                var user = new Object();
                planInstances = getSortedItemsPospaid(snatchInstances(planWallet.FreeUnitItemDetail, bundlePlanChildOffers, false, true, false));
                tmpInstances_plan = splitInstancesPlan(planInstances, activePlanSeq);
                plan = setPlanCBS(tmpInstances_plan, planBillCycle);
            }

        }
    }



    if (navObject.offeringJson.filled) {
        if (typeof (planBillCycle) != 'undefined') {
            user.subscriberId = subscriberId.toString();
            user.billCycle = parseInt(planBillCycle).toString();
            //user.billCycle = planBillCycle;
        }
    }
}
//


//mashinfo
    var BPMN_RESPONSE_CODE = '0';
var BPMN_RESPONSE_MESSAGE = 'Operation Successful';
var servicesObj = {services: new Object()};
var JSON_RESPONSE = '';
servicesObj.services.bundles = bundles;
servicesObj.services.packages = packages;
servicesObj.services.subscriptions = subscriptionItems;
servicesObj.services.applications = applications ;
servicesObj.services.addons = addons;
servicesObj.services.addons_t2 = addonsT2;
servicesObj.services.plan = plan;
servicesObj.services.user = user;
//JSON_RESPONSE = JSON.stringify(servicesObj);
//
JSON_RESPONSE=servicesObj;

return JSON_RESPONSE;

        }

    </script>






</body>

</html>